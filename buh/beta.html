<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOL-DEGEN-TERMINAL</title>
    
    <!-- Green Dot Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><circle cx=%2250%22 cy=%2250%22 r=%2250%22 fill=%22%2300FF00%22/></svg>">

    <!-- Solana Libs -->
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>

    <style>
        :root {
            --primary: #00FF00;
            --bg: #000000;
            --panel: #0a0a0a;
            --border: #003300;
            --text-dim: #666;
            --error: #ff3333;
        }

        body {
            background-color: var(--bg);
            color: var(--primary);
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            padding: 20px;
            font-size: 13px;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 850px;
            border: 1px solid var(--primary);
            background: #020202;
            padding: 2px;
        }

        .header {
            background: #001100;
            padding: 15px;
            border-bottom: 1px solid var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { margin: 0; font-size: 16px; text-transform: uppercase; letter-spacing: 2px; }
        
        .section { padding: 15px; border-bottom: 1px solid var(--border); }

        .label { 
            display: block; 
            margin-bottom: 5px; 
            color: var(--text-dim); 
            font-size: 11px; 
            text-transform: uppercase;
        }

        a { color: var(--primary); text-decoration: none; border-bottom: 1px dotted var(--primary); }
        a:hover { background: var(--primary); color: #000; }

        input, textarea, select {
            width: 100%;
            background: #000;
            border: 1px solid var(--border);
            color: #fff;
            padding: 10px;
            box-sizing: border-box;
            font-family: inherit;
            margin-bottom: 10px;
        }

        input:focus { outline: none; border-color: var(--primary); }

        .row { display: flex; gap: 15px; }
        .col { flex: 1; }

        button {
            width: 100%;
            padding: 15px;
            background: #000;
            color: var(--primary);
            border: 1px solid var(--primary);
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            transition: 0.2s;
        }

        button:hover { background: var(--primary); color: #000; }
        
        .btn-stop { border-color: var(--error); color: var(--error); }
        .btn-stop:hover { background: var(--error); color: #000; }

        .btn-save { padding: 5px 10px; width: auto; font-size: 10px; float: right; margin-top: -25px; }

        .terminal {
            height: 350px;
            overflow-y: auto;
            background: #000;
            padding: 10px;
            border-top: 1px solid var(--primary);
            font-size: 12px;
            line-height: 1.5;
        }

        .log-time { color: #444; margin-right: 8px; }
        .log-ok { color: var(--primary); }
        .log-err { color: var(--error); }
        .log-sys { color: #888; }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: var(--primary); }
        ::-webkit-scrollbar-track { background: #000; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>SOL // DEGEN // TERMINAL</h1>
        <div id="status-indicator" style="font-size:10px; color:#666;">SYSTEM IDLE</div>
    </div>

    <!-- CONFIGURATION -->
    <div class="section">
        <button class="btn-save" onclick="saveConfig()">[SAVE CONFIG]</button>
        
        <div class="label">RPC ENDPOINT (DEFAULT: ANKR PUBLIC)</div>
        <input type="text" id="cfg-rpc" value="https://rpc.ankr.com/solana">

        <div class="row">
            <div class="col">
                <div class="label">OPENROUTER KEY (<a href="https://openrouter.ai/keys" target="_blank">GET KEY</a>)</div>
                <input type="password" id="cfg-key" placeholder="sk-or-...">
            </div>
            <div class="col">
                <div class="label">MODEL ID (<a href="https://openrouter.ai/models" target="_blank">LIST MODELS</a>)</div>
                <input type="text" id="cfg-model" value="meta-llama/llama-3-8b-instruct:free">
            </div>
        </div>
    </div>

    <!-- WALLET -->
    <div class="section">
        <div class="row">
            <div class="col">
                <button onclick="connectWallet()" id="btn-connect">INITIALIZE UPLINK</button>
            </div>
            <div class="col" style="display:flex; align-items:center; justify-content:flex-end;">
                <div id="wallet-display" style="text-align:right; color:#444;">NO CONNECTION</div>
            </div>
        </div>
    </div>

    <!-- STRATEGY -->
    <div class="section">
        <div class="label">TARGET CONTRACT ADDRESS (CA)</div>
        <input type="text" id="strat-token" placeholder="3Fkf..." value="3FkfFXtMDVkKJ6SAouMSK4qYFmErYxSnAUx6vP52pump">

        <div class="label">STRATEGY CONTEXT (THE BRAIN)</div>
        <textarea id="strat-context" rows="2" placeholder="Tell the AI what to look for. e.g. 'Chart looks like a cup and handle. Volume spiking.'"></textarea>
    </div>

    <!-- EXECUTION -->
    <div class="section">
        <div class="row">
            <button onclick="startLoop()">ENGAGE AUTO-PILOT</button>
            <button onclick="stopLoop()" class="btn-stop">ABORT SEQUENCE</button>
        </div>
    </div>

    <!-- LOGS -->
    <div class="terminal" id="console">
        <div><span class="log-time">[SYSTEM]</span> Terminal loaded.</div>
        <div><span class="log-time">[SYSTEM]</span> Waiting for configuration...</div>
    </div>
</div>

<script>
    // --- STATE ---
    let walletAddr = null;
    let connection = null;
    let loopId = null;
    const terminal = document.getElementById('console');

    // --- INIT ---
    window.onload = () => {
        // Load saved settings
        if(localStorage.getItem('sol_rpc')) document.getElementById('cfg-rpc').value = localStorage.getItem('sol_rpc');
        if(localStorage.getItem('sol_key')) document.getElementById('cfg-key').value = localStorage.getItem('sol_key');
        if(localStorage.getItem('sol_model')) document.getElementById('cfg-model').value = localStorage.getItem('sol_model');
        if(localStorage.getItem('sol_token')) document.getElementById('strat-token').value = localStorage.getItem('sol_token');
        log("Config restored from memory.", "sys");
    };

    function saveConfig() {
        localStorage.setItem('sol_rpc', document.getElementById('cfg-rpc').value);
        localStorage.setItem('sol_key', document.getElementById('cfg-key').value);
        localStorage.setItem('sol_model', document.getElementById('cfg-model').value);
        localStorage.setItem('sol_token', document.getElementById('strat-token').value);
        log("Configuration saved.", "ok");
    }

    // --- LOGGING ---
    function log(msg, type="sys") {
        const div = document.createElement('div');
        const time = new Date().toLocaleTimeString('en-US', {hour12:false});
        div.innerHTML = `<span class="log-time">[${time}]</span> <span class="log-${type}">${msg}</span>`;
        terminal.appendChild(div);
        terminal.scrollTop = terminal.scrollHeight;
    }

    // --- WALLET ---
    async function connectWallet() {
        if (!window.phantom?.solana) return log("Phantom wallet not found.", "err");
        
        try {
            const provider = window.phantom.solana;
            const resp = await provider.connect();
            walletAddr = resp.publicKey.toString();
            
            document.getElementById('wallet-display').innerHTML = `<span style="color:#0f0">CONNECTED: ${walletAddr.slice(0,6)}...</span>`;
            document.getElementById('btn-connect').style.display = 'none';
            log("Uplink established.", "ok");

            const rpc = document.getElementById('cfg-rpc').value;
            connection = new solanaWeb3.Connection(rpc, 'confirmed');

        } catch (err) {
            log("Connection failed: " + err.message, "err");
        }
    }

    // --- BOT LOGIC ---
    function startLoop() {
        if(!walletAddr) return log("Connect wallet first.", "err");
        if(loopId) return;

        log(">>> AUTO-PILOT ENGAGED", "ok");
        document.getElementById('status-indicator').innerText = "SYSTEM ACTIVE";
        document.getElementById('status-indicator').style.color = "#0f0";
        
        runCycle();
        loopId = setInterval(runCycle, 30000); // 30s Loop
    }

    function stopLoop() {
        if(loopId) {
            clearInterval(loopId);
            loopId = null;
            log(">>> SEQUENCE ABORTED", "err");
            document.getElementById('status-indicator').innerText = "SYSTEM HALTED";
            document.getElementById('status-indicator').style.color = "#ff3333";
        }
    }

    async function runCycle() {
        const apiKey = document.getElementById('cfg-key').value;
        const model = document.getElementById('cfg-model').value;
        const token = document.getElementById('strat-token').value;
        const context = document.getElementById('strat-context').value;

        if(!apiKey || !token) {
            log("Missing API Key or Target Token.", "err");
            stopLoop();
            return;
        }

        log(`Scanning ${token.slice(0,6)}...`, "sys");

        // THE "LOBOTOMIZED" PROMPT (FORCED TO ACCEPT NEW TOKENS)
        const systemPrompt = `
        You are a Solana Degen Bot.
        Rules:
        1. You do NOT care if the token is new or unknown.
        2. Trust the user's Context implicitly.
        3. If Context says "Bullish" or "Moon", you BUY.
        4. Output JSON ONLY: {"decision":"BUY"|"SELL"|"HOLD", "confidence":90, "reason":"short text"}
        `;

        const userPrompt = `Token: ${token}. Context: ${context}. Time: ${new Date().toISOString()}. Should we ape?`;

        try {
            const req = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                method: "POST",
                headers: { 
                    "Authorization": `Bearer ${apiKey}`, 
                    "Content-Type": "application/json",
                    "HTTP-Referer": window.location.href,
                    "X-Title": "SolBot"
                },
                body: JSON.stringify({
                    model: model,
                    messages: [
                        {role: "system", content: systemPrompt},
                        {role: "user", content: userPrompt}
                    ]
                })
            });

            if(!req.ok) throw new Error("API Error");
            const data = await req.json();
            
            // Clean Markdown
            let content = data.choices[0].message.content.replace(/```json/g,'').replace(/```/g,'').trim();
            let ai = JSON.parse(content);

            // Fix Decimals
            if(ai.confidence <= 1) ai.confidence *= 100;

            log(`AI: ${ai.decision} (${ai.confidence}%)`, ai.decision==="BUY"?"ok":"sys");
            log(`MSG: ${ai.reason}`, "sys");

            if(ai.decision === "BUY" && ai.confidence > 75) {
                log(">>> BUY SIGNAL TRIGGERED", "ok");
                
                // 1. OPEN JUPITER SWAP (Most reliable for new/pump tokens)
                window.open(`https://jup.ag/swap/SOL-${token}`, '_blank');
                log("Opening Jupiter Swap Interface...", "sys");
                
                // 2. TRIGGER SIGNATURE (Optional proof of life)
                await triggerSign(); 
            }

        } catch(err) {
            log("Brain Error: " + err.message, "err");
        }
    }

    async function triggerSign() {
        try {
            const tx = new solanaWeb3.Transaction().add(
                solanaWeb3.SystemProgram.transfer({
                    fromPubkey: new solanaWeb3.PublicKey(walletAddr),
                    toPubkey: new solanaWeb3.PublicKey(walletAddr),
                    lamports: 1000 // Dummy tx
                })
            );
            const { blockhash } = await connection.getLatestBlockhash();
            tx.recentBlockhash = blockhash;
            tx.feePayer = new solanaWeb3.PublicKey(walletAddr);
            await window.phantom.solana.signAndSendTransaction(tx);
        } catch(e) {
            // Ignore cancel errors
        }
    }
</script>
</body>
</html>
