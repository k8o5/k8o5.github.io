<!DOCTYPE html>
<!-- SOL-Phantom-AI-Bot v1.3 (With the Linky Thing) -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOL-Phantom-AI-Bot</title>
    <!-- Solana Web3.js -->
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
</head>
<body style="background-color: #000000; color: #00FF00; font-family: 'Courier New', Courier, monospace; margin: 20px;">

    <!-- APP CONTAINER -->
    <div style="max-width: 800px; margin: 0 auto; border: 2px solid #00FF00; padding: 20px;">
        
        <!-- HEADER -->
        <div style="border-bottom: 1px solid #00FF00; margin-bottom: 20px; padding-bottom: 10px;">
            <h1 style="margin: 0;">ðŸ‘» PHANTOM x OPENROUTER BOT</h1>
            <small>Autonomous AI Agent (Now with links for smart people)</small>
        </div>

        <!-- 1. CONFIGURATION -->
        <div style="margin-bottom: 20px;">
            <h3 style="background-color: #003300; padding: 5px;">[1] SYSTEM CONFIG</h3>
            
            <div style="margin-bottom: 10px;">
                <label>OPENROUTER API KEY (<a href="https://openrouter.ai/keys" target="_blank" style="color: #00FF00; text-decoration: underline;">GET KEY HERE</a>):</label><br>
                <input type="password" id="or-api-key" style="width: 100%; background: #111; border: 1px solid #00FF00; color: #fff; padding: 5px;" placeholder="sk-or-...">
            </div>

            <!-- HERE IS THE BOX AND THE NEW LINK -->
            <div style="margin-bottom: 10px;">
                <label>AI MODEL NAME (<a href="https://openrouter.ai/models" target="_blank" style="color: #00FF00; text-decoration: underline;">FIND MODELS HERE</a>):</label><br>
                <input type="text" id="ai-model" value="meta-llama/llama-3-8b-instruct:free" style="width: 100%; background: #111; border: 1px solid #00FF00; color: #fff; padding: 5px;" placeholder="e.g. deepseek/deepseek-r1:free">
                <small style="color: #666;">Copy the ID from the website. Don't mess it up.</small>
            </div>

            <div style="margin-bottom: 10px;">
                <label>RPC URL (Optional):</label><br>
                <input type="text" id="sol-rpc" value="https://api.mainnet-beta.solana.com" style="width: 100%; background: #111; border: 1px solid #00FF00; color: #fff; padding: 5px;">
            </div>
        </div>

        <!-- 2. WALLET -->
        <div style="margin-bottom: 20px;">
            <h3 style="background-color: #003300; padding: 5px;">[2] WALLET UPLINK</h3>
            <button id="btn-connect" onclick="connectWallet()" style="background: rgb(0, 255, 0); color: rgb(0, 0, 0); border: none; padding: 10px 20px; font-weight: bold; cursor: pointer;">CONNECT PHANTOM</button>
            <div id="wallet-status" style="margin-top: 10px; color: #666;">STATUS: DISCONNECTED</div>
            <div id="wallet-balance" style="margin-top: 5px;">BALANCE: - SOL</div>
        </div>

        <!-- 3. TRADING STUFF -->
        <div style="margin-bottom: 20px;">
            <h3 style="background-color: #003300; padding: 5px;">[3] AGENT PARAMETERS</h3>
            
            <div style="display: flex; gap: 10px;">
                <div style="flex: 1;">
                    <label>TARGET TOKEN (CA):</label>
                    <input type="text" id="target-token" placeholder="Example: So111..." style="width: 100%; background: #111; border: 1px solid #00FF00; color: #fff; padding: 5px;">
                </div>
                <div style="flex: 1;">
                    <label>AMOUNT (SOL):</label>
                    <input type="number" id="trade-amount" value="0.01" step="0.001" style="width: 100%; background: #111; border: 1px solid #00FF00; color: #fff; padding: 5px;">
                </div>
            </div>

            <div style="margin-top: 10px;">
                <label>MARKET CONTEXT:</label>
                <textarea id="market-context" rows="3" style="width: 100%; background: #111; border: 1px solid #00FF00; color: #fff; padding: 5px;" placeholder="Tell the robot what is happening..."></textarea>
            </div>
        </div>

        <!-- 4. GO BUTTON -->
        <div style="margin-bottom: 20px;">
            <h3 style="background-color: #003300; padding: 5px;">[4] EXECUTION</h3>
            <button id="btn-run-ai" onclick="runAIBot()" style="background: #000; color: #00FF00; border: 2px solid #00FF00; padding: 15px 30px; font-weight: bold; font-size: 16px; cursor: pointer; width: 100%;">
                INITIALIZE AI THINGY
            </button>
        </div>

        <!-- CONSOLE -->
        <div style="border: 1px solid #333; height: 300px; overflow-y: scroll; background: #050505; padding: 10px;" id="console-output">
            <div>&gt; System initialized...</div>
            <div>&gt; Waiting for inputs...</div>
        </div>

    </div>

    <script>
        // --- VARIABLES ---
        let walletAddress = null;
        let connection = null;
        const terminal = document.getElementById('console-output');

        function log(msg, type = 'info') {
            const div = document.createElement('div');
            div.innerHTML = `<span style="color: #666;">[${new Date().toLocaleTimeString()}]</span> ${msg}`;
            if (type === 'error') div.style.color = 'red';
            if (type === 'success') div.style.color = 'cyan';
            terminal.appendChild(div);
            terminal.scrollTop = terminal.scrollHeight;
        }

        // --- WALLET STUFF ---
        async function connectWallet() {
            if ("phantom" in window) {
                const provider = window.phantom?.solana;
                if (provider?.isPhantom) {
                    try {
                        const resp = await provider.connect();
                        walletAddress = resp.publicKey.toString();
                        
                        document.getElementById('wallet-status').innerText = `STATUS: CONNECTED [${walletAddress.slice(0,6)}...]`;
                        document.getElementById('wallet-status').style.color = "cyan";
                        document.getElementById('btn-connect').style.display = 'none';
                        
                        log(`Wallet connected: ${walletAddress}`, 'success');
                        
                        const rpc = document.getElementById('sol-rpc').value;
                        connection = new solanaWeb3.Connection(rpc, 'confirmed');
                        getBalance();

                    } catch (err) {
                        log(`Uh oh: ${err.message}`, 'error');
                    }
                }
            } else {
                window.open("https://phantom.app/", "_blank");
                log("No Phantom? How you trade without wallet? Duh.", 'error');
            }
        }

        async function getBalance() {
            if (!walletAddress || !connection) return;
            try {
                const pubKey = new solanaWeb3.PublicKey(walletAddress);
                const balance = await connection.getBalance(pubKey);
                document.getElementById('wallet-balance').innerText = `BALANCE: ${balance / solanaWeb3.LAMPORTS_PER_SOL} SOL`;
            } catch (err) {
                log(`Can't see money: ${err.message}`, 'error');
            }
        }

        // --- AI BRAIN STUFF ---
        async function callOpenRouter(prompt) {
            const apiKey = document.getElementById('or-api-key').value;
            // I AM GRABBING THE TEXT YOU TYPED HERE
            const modelID = document.getElementById('ai-model').value; 

            if (!apiKey) {
                throw new Error("No Password (API Key). I can't think.");
            }

            if (!modelID) {
                throw new Error("You didn't type a model name! I don't know who to call!");
            }

            const sysPrompt = `
            You are a Solana trading bot. 
            Output JSON only.
            Format:
            {
                "decision": "BUY" | "SELL" | "HOLD",
                "confidence": number,
                "reasoning": "string",
                "action": "string"
            }
            Do not write markdown. Just JSON.
            `;

            log(`Calling Model ID: ${modelID}...`, 'info');

            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${apiKey}`,
                        "Content-Type": "application/json",
                        "HTTP-Referer": window.location.href, 
                        "X-Title": "SolanaPhantomBot"
                    },
                    body: JSON.stringify({
                        "model": modelID, 
                        "messages": [
                            {"role": "system", "content": sysPrompt},
                            {"role": "user", "content": prompt}
                        ],
                        "temperature": 0.7
                    })
                });

                if (!response.ok) {
                    const err = await response.json();
                    throw new Error(`Brain broken: ${err.error?.message || response.statusText}`);
                }

                const data = await response.json();
                let content = data.choices[0].message.content;
                
                // Remove weird markdown computer text if the robot adds it
                content = content.replace(/```json/g, '').replace(/```/g, '').trim();
                
                return JSON.parse(content);

            } catch (error) {
                throw error;
            }
        }

        // --- MAIN BOT LOGIC ---
        async function runAIBot() {
            if (!walletAddress) {
                log("Connect wallet first. I cannot conjure money.", 'error');
                return;
            }

            const token = document.getElementById('target-token').value;
            const context = document.getElementById('market-context').value;
            const amount = document.getElementById('trade-amount').value;

            if (!token) {
                log("Where is the token address? I am not psychic.", 'error');
                return;
            }

            const prompt = `Target: ${token}. Amount: ${amount} SOL. Context: ${context}. Time: ${new Date().toISOString()}.`;

            try {
                // 1. AI Analysis
                const aiDecision = await callOpenRouter(prompt);
                
                log("--------------------------------", 'info');
                log(`BRAIN SAYS: ${aiDecision.decision} (${aiDecision.confidence}%)`, aiDecision.decision === 'BUY' ? 'success' : 'info');
                log(`WHY: ${aiDecision.reasoning}`);
                log("--------------------------------", 'info');

                // 2. Execution Logic
                if (aiDecision.decision === "BUY" && aiDecision.confidence > 70) {
                    await executeSwap(token, amount);
                } else if (aiDecision.decision === "SELL" && aiDecision.confidence > 70) {
                    log("I would sell, but I am scared to lose your money. Sell manually.", 'info');
                } else {
                    log("Brain says wait. Or confidence too low. Doing nothing.", 'info');
                }

            } catch (err) {
                log(`I failed: ${err.message}`, 'error');
            }
        }

        // --- TRANSACTION STUFF ---
        async function executeSwap(tokenAddress, amountSol) {
            log(`Making transaction... Swap ${amountSol} SOL...`);

            try {
                const provider = window.phantom?.solana;
                const pubKey = new solanaWeb3.PublicKey(walletAddress);
                
                // Simple Transfer to self for safety/demo
                log("Building transaction...", 'info');
                
                const transaction = new solanaWeb3.Transaction().add(
                    solanaWeb3.SystemProgram.transfer({
                        fromPubkey: pubKey,
                        toPubkey: pubKey, // Sending to self
                        lamports: solanaWeb3.LAMPORTS_PER_SOL * (amountSol / 1000) // Tiny amount
                    })
                );

                const { blockhash } = await connection.getLatestBlockhash();
                transaction.recentBlockhash = blockhash;
                transaction.feePayer = pubKey;

                log("PLEASE SIGN IN WALLET NOW!", 'info');

                const { signature } = await provider.signAndSendTransaction(transaction);
                
                log(`Done!`, 'success');
                log(`Sig: ${signature}`);

            } catch (err) {
                log(`Transaction died: ${err.message}`, 'error');
            }
        }
    </script>
</body></html>
