<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé£ Cozy Fishing Paradise</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            overflow-x: hidden;
            color: #fff;
        }

        .game-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 10px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
        }

        .currency {
            display: flex;
            gap: 20px;
        }

        .currency-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.1);
            padding: 8px 15px;
            border-radius: 25px;
        }

        .currency-item.gold { color: #ffd700; }
        .currency-item.gems { color: #e040fb; }

        .level-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: bold;
        }

        .main-area {
            display: grid;
            grid-template-columns: 280px 1fr 300px;
            gap: 15px;
            height: calc(100vh - 120px);
        }

        .side-panel {
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            padding: 15px;
            backdrop-filter: blur(10px);
            overflow-y: auto;
        }

        .fishing-area {
            background: linear-gradient(180deg, #87CEEB 0%, #4a90a4 30%, #2d5a6b 60%, #1a3a4a 100%);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .water-surface {
            position: absolute;
            top: 30%;
            left: 0;
            right: 0;
            height: 5px;
            background: rgba(255,255,255,0.3);
            animation: wave 2s ease-in-out infinite;
        }

        @keyframes wave {
            0%, 100% { transform: scaleX(1); opacity: 0.3; }
            50% { transform: scaleX(1.02); opacity: 0.5; }
        }

        .sun {
            position: absolute;
            top: 30px;
            right: 50px;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, #fff7aa 0%, #ffd700 50%, transparent 70%);
            border-radius: 50%;
            animation: glow 3s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.1); opacity: 1; }
        }

        .clouds {
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 100px;
        }

        .cloud {
            position: absolute;
            background: rgba(255,255,255,0.8);
            border-radius: 50px;
            animation: float 20s linear infinite;
        }

        @keyframes float {
            0% { transform: translateX(-100px); }
            100% { transform: translateX(calc(100vw + 100px)); }
        }

        .fishing-line {
            position: absolute;
            width: 2px;
            background: linear-gradient(180deg, #8B4513, #654321);
            transform-origin: top center;
            display: none;
        }

        .bobber {
            position: absolute;
            width: 15px;
            height: 25px;
            background: linear-gradient(180deg, #ff4444 50%, #ffffff 50%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            display: none;
            transition: transform 0.3s;
        }

        .bobber.nibble {
            animation: nibble 0.2s ease-in-out infinite;
        }

        .bobber.bite {
            animation: bite 0.15s ease-in-out infinite;
        }

        @keyframes nibble {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(3px) rotate(5deg); }
        }

        @keyframes bite {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(8px) rotate(-10deg); }
            75% { transform: translateY(5px) rotate(10deg); }
        }

        .fish-shadow {
            position: absolute;
            opacity: 0.3;
            transition: all 0.5s;
        }

        .catch-prompt {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 20px rgba(0,0,0,0.5);
            display: none;
            animation: pulse 0.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }

        .progress-bar {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 30px;
            background: rgba(0,0,0,0.5);
            border-radius: 15px;
            overflow: hidden;
            display: none;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.1s;
            border-radius: 15px;
        }

        .progress-target {
            position: absolute;
            top: 0;
            width: 40px;
            height: 100%;
            background: rgba(255,255,255,0.3);
            border: 2px solid #fff;
            border-radius: 10px;
        }

        .cast-power {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 20px;
            background: rgba(0,0,0,0.5);
            border-radius: 10px;
            overflow: hidden;
            display: none;
        }

        .power-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #FFC107, #f44336);
            width: 0%;
            transition: width 0.05s linear;
        }

        .instruction {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            padding: 10px 25px;
            border-radius: 25px;
            font-size: 1.1rem;
        }

        .panel-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tab-buttons {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }

        .tab-btn {
            flex: 1;
            padding: 8px;
            border: none;
            background: rgba(255,255,255,0.1);
            color: #fff;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            max-height: 400px;
            overflow-y: auto;
        }

        .fish-card {
            aspect-ratio: 1;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
        }

        .fish-card:hover {
            transform: scale(1.05);
        }

        .fish-card.consumer { border-color: #b0c3d9; background: linear-gradient(135deg, rgba(176,195,217,0.2), rgba(176,195,217,0.1)); }
        .fish-card.industrial { border-color: #5e98d9; background: linear-gradient(135deg, rgba(94,152,217,0.2), rgba(94,152,217,0.1)); }
        .fish-card.milspec { border-color: #4b69ff; background: linear-gradient(135deg, rgba(75,105,255,0.2), rgba(75,105,255,0.1)); }
        .fish-card.restricted { border-color: #8847ff; background: linear-gradient(135deg, rgba(136,71,255,0.2), rgba(136,71,255,0.1)); }
        .fish-card.classified { border-color: #d32ce6; background: linear-gradient(135deg, rgba(211,44,230,0.2), rgba(211,44,230,0.1)); }
        .fish-card.covert { border-color: #eb4b4b; background: linear-gradient(135deg, rgba(235,75,75,0.2), rgba(235,75,75,0.1)); }
        .fish-card.legendary { border-color: #ffd700; background: linear-gradient(135deg, rgba(255,215,0,0.3), rgba(255,165,0,0.2)); animation: legendary-glow 2s infinite; }

        @keyframes legendary-glow {
            0%, 100% { box-shadow: 0 0 10px rgba(255,215,0,0.5); }
            50% { box-shadow: 0 0 25px rgba(255,215,0,0.8); }
        }

        .fish-emoji {
            font-size: 2rem;
        }

        .fish-count {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: rgba(0,0,0,0.7);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
        }

        .stats-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }

        .shop-item {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .shop-item:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }

        .shop-item.owned {
            border: 2px solid #4CAF50;
        }

        .shop-item.equipped {
            border: 2px solid #2196F3;
            box-shadow: 0 0 15px rgba(33,150,243,0.3);
        }

        .shop-icon {
            font-size: 2rem;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }

        .shop-info {
            flex: 1;
        }

        .shop-name {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .shop-desc {
            font-size: 0.85rem;
            opacity: 0.7;
        }

        .shop-price {
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            color: #000;
            padding: 5px 12px;
            border-radius: 15px;
            font-weight: bold;
        }

        .location-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .location-card:hover {
            transform: scale(1.02);
        }

        .location-card.active {
            border: 2px solid #4CAF50;
        }

        .location-card.locked {
            opacity: 0.5;
        }

        .location-name {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .location-desc {
            font-size: 0.85rem;
            opacity: 0.7;
        }

        .catch-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .catch-content {
            text-align: center;
            animation: pop-in 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes pop-in {
            0% { transform: scale(0) rotate(-10deg); opacity: 0; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .catch-rarity {
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 10px;
        }

        .catch-rarity.consumer { color: #b0c3d9; }
        .catch-rarity.industrial { color: #5e98d9; }
        .catch-rarity.milspec { color: #4b69ff; }
        .catch-rarity.restricted { color: #8847ff; }
        .catch-rarity.classified { color: #d32ce6; }
        .catch-rarity.covert { color: #eb4b4b; }
        .catch-rarity.legendary { color: #ffd700; text-shadow: 0 0 20px rgba(255,215,0,0.8); }

        .catch-fish {
            font-size: 8rem;
            margin: 20px 0;
            animation: fish-bounce 1s ease-in-out infinite;
        }

        @keyframes fish-bounce {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        .catch-name {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .catch-details {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
        }

        .catch-detail {
            text-align: center;
        }

        .catch-detail-value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .catch-detail-label {
            font-size: 0.85rem;
            opacity: 0.7;
        }

        .catch-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
        }

        .btn-sell {
            background: linear-gradient(135deg, #ffd700 0%, #ffaa00 100%);
            color: #000;
        }

        .btn:hover {
            transform: scale(1.05);
        }

        .bubbles {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 70%;
            pointer-events: none;
            overflow: hidden;
        }

        .bubble {
            position: absolute;
            bottom: -20px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            animation: rise 4s ease-in infinite;
        }

        @keyframes rise {
            0% { transform: translateY(0) scale(1); opacity: 0.5; }
            100% { transform: translateY(-500px) scale(0.5); opacity: 0; }
        }

        .seaweed {
            position: absolute;
            bottom: 0;
            width: 20px;
            height: 80px;
            background: linear-gradient(180deg, #228B22, #006400);
            border-radius: 50% 50% 0 0;
            transform-origin: bottom center;
            animation: sway 3s ease-in-out infinite;
        }

        @keyframes sway {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }

        .xp-bar {
            width: 100%;
            height: 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }

        .xp-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s;
        }

        .tooltip {
            position: fixed;
            background: rgba(0,0,0,0.9);
            padding: 15px;
            border-radius: 10px;
            max-width: 250px;
            z-index: 1001;
            pointer-events: none;
            display: none;
        }

        .new-badge {
            position: absolute;
            top: 5px;
            left: 5px;
            background: #f44336;
            color: #fff;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .streak-bonus {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #ff9800, #f44336);
            padding: 5px 20px;
            border-radius: 20px;
            font-weight: bold;
            display: none;
        }

        .particles {
            position: absolute;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: particle-fly 1s ease-out forwards;
        }

        @keyframes particle-fly {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0) translateY(-100px); opacity: 0; }
        }

        .collection-progress {
            margin-top: 15px;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }

        .collection-bar {
            height: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            overflow: hidden;
            margin-top: 8px;
        }

        .collection-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.5s;
        }

        .weather-icon {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 2rem;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 50%;
        }

        .time-display {
            position: absolute;
            top: 10px;
            left: 70px;
            background: rgba(0,0,0,0.3);
            padding: 8px 15px;
            border-radius: 20px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.9);
            padding: 15px 25px;
            border-radius: 10px;
            transform: translateX(400px);
            transition: transform 0.5s;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .combo-display {
            position: absolute;
            top: 50px;
            right: 10px;
            background: rgba(0,0,0,0.5);
            padding: 10px 15px;
            border-radius: 10px;
            display: none;
        }

        .rod-display {
            position: absolute;
            top: 40%;
            left: 30px;
            font-size: 4rem;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
            transform-origin: bottom right;
            transition: transform 0.3s;
        }

        .rod-display.casting {
            animation: cast-rod 0.5s ease-out;
        }

        @keyframes cast-rod {
            0% { transform: rotate(0deg); }
            50% { transform: rotate(-45deg); }
            100% { transform: rotate(-20deg); }
        }

        .quest-panel {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 10px;
            margin-top: 15px;
        }

        .quest-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .quest-progress {
            flex: 1;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .quest-progress-fill {
            height: 100%;
            background: #4CAF50;
        }

        @media (max-width: 1200px) {
            .main-area {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .side-panel {
                max-height: 400px;
            }
            
            .fishing-area {
                min-height: 500px;
            }
        }

        .settings-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            padding: 10px 15px;
            border-radius: 10px;
            color: #fff;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <div class="level-badge">
                <span id="level-display">Level 1</span>
                <div class="xp-bar">
                    <div class="xp-fill" id="xp-fill" style="width: 0%"></div>
                </div>
            </div>
            <div class="currency">
                <div class="currency-item gold">
                    <span>üí∞</span>
                    <span id="gold-display">0</span>
                </div>
                <div class="currency-item gems">
                    <span>üíé</span>
                    <span id="gems-display">0</span>
                </div>
            </div>
            <button class="settings-btn" onclick="toggleSound()">üîä Sound</button>
        </div>

        <div class="main-area">
            <div class="side-panel">
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="switchTab('inventory')">üéí Bag</button>
                    <button class="tab-btn" onclick="switchTab('collection')">üìö Dex</button>
                </div>
                
                <div id="inventory-tab">
                    <div class="panel-title">üêü Your Fish</div>
                    <div class="inventory-grid" id="inventory-grid"></div>
                    <div class="collection-progress">
                        <span>Collection: <span id="collection-count">0</span>/<span id="total-fish">0</span></span>
                        <div class="collection-bar">
                            <div class="collection-fill" id="collection-fill" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div id="collection-tab" style="display: none;">
                    <div class="panel-title">üìñ Fish Collection</div>
                    <div class="inventory-grid" id="collection-grid"></div>
                </div>

                <div class="quest-panel">
                    <div class="panel-title">üìã Daily Quests</div>
                    <div id="quests-container"></div>
                </div>
            </div>

            <div class="fishing-area" id="fishing-area">
                <div class="weather-icon" id="weather-icon">‚òÄÔ∏è</div>
                <div class="time-display" id="time-display">6:00 AM</div>
                <div class="sun" id="sun"></div>
                <div class="clouds" id="clouds"></div>
                <div class="water-surface"></div>
                <div class="bubbles" id="bubbles"></div>
                
                <div class="rod-display" id="rod-display">üé£</div>
                <div class="fishing-line" id="fishing-line"></div>
                <div class="bobber" id="bobber"></div>
                
                <div class="catch-prompt" id="catch-prompt">üéØ CLICK NOW!</div>
                <div class="progress-bar" id="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                    <div class="progress-target" id="progress-target"></div>
                </div>
                <div class="cast-power" id="cast-power">
                    <div class="power-fill" id="power-fill"></div>
                </div>
                <div class="streak-bonus" id="streak-bonus">üî• Streak x1</div>
                <div class="combo-display" id="combo-display">Combo: x1</div>
                <div class="instruction" id="instruction">Click or press SPACE to cast!</div>
                
                <div class="particles" id="particles"></div>
            </div>

            <div class="side-panel">
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="switchShopTab('rods')">üé£ Rods</button>
                    <button class="tab-btn" onclick="switchShopTab('bait')">ü™± Bait</button>
                    <button class="tab-btn" onclick="switchShopTab('locations')">üó∫Ô∏è Spots</button>
                </div>

                <div id="rods-tab">
                    <div class="panel-title">üé£ Fishing Rods</div>
                    <div id="rods-container"></div>
                </div>

                <div id="bait-tab" style="display: none;">
                    <div class="panel-title">ü™± Bait Shop</div>
                    <div id="bait-container"></div>
                </div>

                <div id="locations-tab" style="display: none;">
                    <div class="panel-title">üó∫Ô∏è Fishing Spots</div>
                    <div id="locations-container"></div>
                </div>

                <div class="stats-list" style="margin-top: 20px;">
                    <div class="panel-title">üìä Stats</div>
                    <div class="stat-item">
                        <span>Total Catches</span>
                        <span id="stat-catches">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Rarest Catch</span>
                        <span id="stat-rarest">None</span>
                    </div>
                    <div class="stat-item">
                        <span>Biggest Fish</span>
                        <span id="stat-biggest">0 kg</span>
                    </div>
                    <div class="stat-item">
                        <span>Total Earned</span>
                        <span id="stat-earned">üí∞ 0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="catch-modal" id="catch-modal">
        <div class="catch-content">
            <div class="catch-rarity" id="modal-rarity">LEGENDARY</div>
            <div class="catch-fish" id="modal-fish">üêü</div>
            <div class="catch-name" id="modal-name">Golden Koi</div>
            <div class="catch-details">
                <div class="catch-detail">
                    <div class="catch-detail-value" id="modal-weight">2.5 kg</div>
                    <div class="catch-detail-label">Weight</div>
                </div>
                <div class="catch-detail">
                    <div class="catch-detail-value" id="modal-value">üí∞ 500</div>
                    <div class="catch-detail-label">Value</div>
                </div>
                <div class="catch-detail">
                    <div class="catch-detail-value" id="modal-xp">+50 XP</div>
                    <div class="catch-detail-label">Experience</div>
                </div>
            </div>
            <div id="modal-new" style="color: #4CAF50; font-size: 1.2rem; display: none;">‚ú® NEW DISCOVERY! ‚ú®</div>
            <div class="catch-buttons">
                <button class="btn btn-primary" onclick="keepFish()">Keep üéí</button>
                <button class="btn btn-sell" onclick="sellFish()">Sell üí∞</button>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>
    <div class="tooltip" id="tooltip"></div>

    <script>
        // Game State
        const gameState = {
            gold: 100,
            gems: 5,
            level: 1,
            xp: 0,
            xpNeeded: 100,
            catches: 0,
            totalEarned: 0,
            biggestFish: 0,
            rarestCatch: 'None',
            streak: 0,
            combo: 1,
            currentRod: 'basic',
            currentBait: 'worm',
            currentLocation: 'pond',
            ownedRods: ['basic'],
            ownedBait: { worm: 999 },
            inventory: {},
            discovered: new Set(),
            soundEnabled: true,
            gameTime: 360,
            weather: 'sunny'
        };

        // Rarity Tiers
        const rarities = {
            consumer: { name: 'Consumer', color: '#b0c3d9', chance: 0.45, multiplier: 1 },
            industrial: { name: 'Industrial', color: '#5e98d9', chance: 0.30, multiplier: 1.5 },
            milspec: { name: 'Mil-Spec', color: '#4b69ff', chance: 0.15, multiplier: 2.5 },
            restricted: { name: 'Restricted', color: '#8847ff', chance: 0.06, multiplier: 5 },
            classified: { name: 'Classified', color: '#d32ce6', chance: 0.025, multiplier: 10 },
            covert: { name: 'Covert', color: '#eb4b4b', chance: 0.01, multiplier: 25 },
            legendary: { name: 'Legendary', color: '#ffd700', chance: 0.005, multiplier: 100 }
        };

        // Fish Database
        const fishDB = {
            // Consumer Grade
            minnow: { name: 'Minnow', emoji: 'üêü', rarity: 'consumer', baseValue: 5, baseWeight: 0.1, location: ['pond', 'river', 'lake', 'ocean', 'deep'] },
            sardine: { name: 'Sardine', emoji: 'üêü', rarity: 'consumer', baseValue: 8, baseWeight: 0.15, location: ['ocean', 'deep'] },
            anchovy: { name: 'Anchovy', emoji: 'üêü', rarity: 'consumer', baseValue: 6, baseWeight: 0.08, location: ['ocean'] },
            guppy: { name: 'Guppy', emoji: 'üê†', rarity: 'consumer', baseValue: 7, baseWeight: 0.05, location: ['pond', 'river'] },
            goldfish: { name: 'Goldfish', emoji: 'üê†', rarity: 'consumer', baseValue: 10, baseWeight: 0.1, location: ['pond'] },
            
            // Industrial Grade
            bass: { name: 'Bass', emoji: 'üêü', rarity: 'industrial', baseValue: 25, baseWeight: 1.5, location: ['pond', 'river', 'lake'] },
            trout: { name: 'Rainbow Trout', emoji: 'üêü', rarity: 'industrial', baseValue: 30, baseWeight: 2, location: ['river', 'lake'] },
            perch: { name: 'Perch', emoji: 'üêü', rarity: 'industrial', baseValue: 22, baseWeight: 1.2, location: ['lake', 'river'] },
            catfish: { name: 'Catfish', emoji: 'üêü', rarity: 'industrial', baseValue: 35, baseWeight: 3, location: ['river', 'lake'] },
            carp: { name: 'Carp', emoji: 'üêü', rarity: 'industrial', baseValue: 28, baseWeight: 2.5, location: ['pond', 'lake'] },
            
            // Mil-Spec
            salmon: { name: 'Salmon', emoji: 'üêü', rarity: 'milspec', baseValue: 75, baseWeight: 5, location: ['river', 'ocean'] },
            tuna: { name: 'Bluefin Tuna', emoji: 'üêü', rarity: 'milspec', baseValue: 100, baseWeight: 8, location: ['ocean', 'deep'] },
            pike: { name: 'Northern Pike', emoji: 'üêü', rarity: 'milspec', baseValue: 80, baseWeight: 6, location: ['lake'] },
            koi: { name: 'Koi', emoji: 'üê†', rarity: 'milspec', baseValue: 90, baseWeight: 3, location: ['pond'] },
            swordfish: { name: 'Swordfish', emoji: 'üêü', rarity: 'milspec', baseValue: 120, baseWeight: 15, location: ['ocean', 'deep'] },
            
            // Restricted
            angelfish: { name: 'Emperor Angelfish', emoji: 'üê†', rarity: 'restricted', baseValue: 200, baseWeight: 1, location: ['ocean', 'deep'] },
            pufferfish: { name: 'Pufferfish', emoji: 'üê°', rarity: 'restricted', baseValue: 250, baseWeight: 2, location: ['ocean'] },
            lionfish: { name: 'Lionfish', emoji: 'üê†', rarity: 'restricted', baseValue: 280, baseWeight: 1.5, location: ['ocean', 'deep'] },
            sturgeon: { name: 'Sturgeon', emoji: 'üêü', rarity: 'restricted', baseValue: 350, baseWeight: 25, location: ['river', 'lake'] },
            marlin: { name: 'Blue Marlin', emoji: 'üêü', rarity: 'restricted', baseValue: 400, baseWeight: 50, location: ['ocean', 'deep'] },
            
            // Classified
            oarfish: { name: 'Oarfish', emoji: 'üêü', rarity: 'classified', baseValue: 800, baseWeight: 100, location: ['deep'] },
            sunfish: { name: 'Ocean Sunfish', emoji: 'üêü', rarity: 'classified', baseValue: 750, baseWeight: 200, location: ['ocean', 'deep'] },
            arapaima: { name: 'Arapaima', emoji: 'üêü', rarity: 'classified', baseValue: 900, baseWeight: 80, location: ['river'] },
            napoleonfish: { name: 'Napoleon Wrasse', emoji: 'üê†', rarity: 'classified', baseValue: 850, baseWeight: 40, location: ['ocean', 'deep'] },
            ghostkoi: { name: 'Ghost Koi', emoji: 'üê†', rarity: 'classified', baseValue: 1000, baseWeight: 5, location: ['pond', 'lake'] },
            
            // Covert
            coelacanth: { name: 'Coelacanth', emoji: 'üêü', rarity: 'covert', baseValue: 2500, baseWeight: 60, location: ['deep'] },
            megamouth: { name: 'Megamouth Shark', emoji: 'ü¶à', rarity: 'covert', baseValue: 3000, baseWeight: 500, location: ['deep'] },
            blobfish: { name: 'Blobfish', emoji: 'üêü', rarity: 'covert', baseValue: 2000, baseWeight: 10, location: ['deep'] },
            barreleye: { name: 'Barreleye', emoji: 'üêü', rarity: 'covert', baseValue: 2800, baseWeight: 0.5, location: ['deep'] },
            
            // Legendary
            dragonfish: { name: 'Dragon Fish', emoji: 'üêâ', rarity: 'legendary', baseValue: 10000, baseWeight: 15, location: ['deep'] },
            goldenkoi: { name: 'Golden Koi', emoji: '‚ú®', rarity: 'legendary', baseValue: 15000, baseWeight: 8, location: ['pond'] },
            cosmicwhale: { name: 'Cosmic Whale', emoji: 'üêã', rarity: 'legendary', baseValue: 25000, baseWeight: 1000, location: ['deep'] },
            phoenixfish: { name: 'Phoenix Fish', emoji: 'üî•', rarity: 'legendary', baseValue: 20000, baseWeight: 3, location: ['ocean', 'deep'] },
            crystaljellyfish: { name: 'Crystal Jellyfish', emoji: 'üíé', rarity: 'legendary', baseValue: 18000, baseWeight: 1, location: ['deep'] }
        };

        // Rods
        const rods = {
            basic: { name: 'Basic Rod', emoji: 'üé£', price: 0, luckBonus: 0, speedBonus: 0, desc: 'A simple fishing rod' },
            bamboo: { name: 'Bamboo Rod', emoji: 'üéã', price: 500, luckBonus: 0.05, speedBonus: 0.1, desc: '+5% rare fish chance' },
            carbon: { name: 'Carbon Fiber Rod', emoji: '‚ö´', price: 2000, luckBonus: 0.1, speedBonus: 0.2, desc: '+10% rare fish chance' },
            titanium: { name: 'Titanium Rod', emoji: 'üî©', price: 8000, luckBonus: 0.15, speedBonus: 0.25, desc: '+15% rare fish chance' },
            golden: { name: 'Golden Rod', emoji: 'üåü', price: 25000, luckBonus: 0.25, speedBonus: 0.3, desc: '+25% rare fish chance' },
            legendary: { name: 'Legendary Rod', emoji: 'üëë', price: 100000, luckBonus: 0.4, speedBonus: 0.4, desc: '+40% rare fish chance' }
        };

        // Bait
        const baits = {
            worm: { name: 'Earthworm', emoji: 'ü™±', price: 0, bonus: 0, desc: 'Basic bait' },
            cricket: { name: 'Cricket', emoji: 'ü¶ó', price: 10, bonus: 0.05, desc: '+5% catch rate' },
            shrimp: { name: 'Shrimp', emoji: 'ü¶ê', price: 25, bonus: 0.1, desc: '+10% catch rate' },
            squid: { name: 'Squid', emoji: 'ü¶ë', price: 50, bonus: 0.15, desc: '+15% catch rate' },
            goldenbait: { name: 'Golden Bait', emoji: '‚ú®', price: 200, bonus: 0.3, desc: '+30% rare chance' }
        };

        // Locations
        const locations = {
            pond: { name: 'Peaceful Pond', emoji: 'üåø', price: 0, unlockLevel: 1, desc: 'A quiet spot for beginners' },
            river: { name: 'Rushing River', emoji: 'üèûÔ∏è', price: 1000, unlockLevel: 5, desc: 'Fast currents, bigger fish' },
            lake: { name: 'Crystal Lake', emoji: 'üíß', price: 5000, unlockLevel: 10, desc: 'Deep waters hide secrets' },
            ocean: { name: 'Open Ocean', emoji: 'üåä', price: 15000, unlockLevel: 20, desc: 'Vast seas, rare catches' },
            deep: { name: 'The Abyss', emoji: 'üåë', price: 50000, unlockLevel: 35, desc: 'Legendary fish lurk here' }
        };

        // Quests
        let quests = [
            { id: 1, desc: 'Catch 5 fish', target: 5, progress: 0, reward: 100, type: 'catch' },
            { id: 2, desc: 'Catch a Mil-Spec fish', target: 1, progress: 0, reward: 250, type: 'rarity', rarityTarget: 'milspec' },
            { id: 3, desc: 'Earn 500 gold', target: 500, progress: 0, reward: 150, type: 'earn' }
        ];

        // Game Variables
        let isFishing = false;
        let isCasting = false;
        let castPower = 0;
        let castDirection = 1;
        let fishingTimeout = null;
        let biteTimeout = null;
        let catchWindow = null;
        let currentCatch = null;
        let minigameActive = false;
        let minigameProgress = 0;
        let minigameTarget = 50;
        let audioContext = null;

        // Initialize Game
        function init() {
            loadGame();
            createEnvironment();
            updateUI();
            renderShop();
            renderLocations();
            renderQuests();
            startGameLoop();
            
            document.getElementById('fishing-area').addEventListener('click', handleClick);
            document.addEventListener('keydown', handleKeyDown);
            document.addEventListener('keyup', handleKeyUp);
        }

        function createEnvironment() {
            // Create clouds
            const cloudsContainer = document.getElementById('clouds');
            for (let i = 0; i < 5; i++) {
                const cloud = document.createElement('div');
                cloud.className = 'cloud';
                cloud.style.width = (60 + Math.random() * 80) + 'px';
                cloud.style.height = (30 + Math.random() * 30) + 'px';
                cloud.style.left = (Math.random() * 100) + '%';
                cloud.style.animationDelay = (Math.random() * 20) + 's';
                cloud.style.animationDuration = (15 + Math.random() * 10) + 's';
                cloudsContainer.appendChild(cloud);
            }

            // Create bubbles
            const bubblesContainer = document.getElementById('bubbles');
            for (let i = 0; i < 15; i++) {
                createBubble(bubblesContainer);
            }

            // Create seaweed
            for (let i = 0; i < 8; i++) {
                const seaweed = document.createElement('div');
                seaweed.className = 'seaweed';
                seaweed.style.left = (5 + i * 12) + '%';
                seaweed.style.height = (50 + Math.random() * 50) + 'px';
                seaweed.style.animationDelay = (Math.random() * 2) + 's';
                document.getElementById('fishing-area').appendChild(seaweed);
            }
        }

        function createBubble(container) {
            const bubble = document.createElement('div');
            bubble.className = 'bubble';
            const size = 5 + Math.random() * 15;
            bubble.style.width = size + 'px';
            bubble.style.height = size + 'px';
            bubble.style.left = (Math.random() * 100) + '%';
            bubble.style.animationDelay = (Math.random() * 4) + 's';
            bubble.style.animationDuration = (3 + Math.random() * 2) + 's';
            container.appendChild(bubble);
            
            bubble.addEventListener('animationend', () => {
                bubble.remove();
                createBubble(container);
            });
        }

        function handleClick(e) {
            if (minigameActive) {
                handleMinigameClick();
                return;
            }

            if (!isFishing && !isCasting) {
                startCasting();
            } else if (isCasting) {
                releaseCast();
            } else if (catchWindow) {
                attemptCatch();
            }
        }

        function handleKeyDown(e) {
            if (e.code === 'Space') {
                e.preventDefault();
                handleClick();
            }
        }

        function handleKeyUp(e) {
            if (e.code === 'Space' && isCasting) {
                releaseCast();
            }
        }

        function startCasting() {
            isCasting = true;
            castPower = 0;
            document.getElementById('cast-power').style.display = 'block';
            document.getElementById('instruction').textContent = 'Release to cast!';
            
            const powerInterval = setInterval(() => {
                if (!isCasting) {
                    clearInterval(powerInterval);
                    return;
                }
                castPower += castDirection * 2;
                if (castPower >= 100) castDirection = -1;
                if (castPower <= 0) castDirection = 1;
                document.getElementById('power-fill').style.width = castPower + '%';
            }, 30);
        }

        function releaseCast() {
            if (!isCasting) return;
            isCasting = false;
            isFishing = true;
            
            document.getElementById('cast-power').style.display = 'none';
            document.getElementById('rod-display').classList.add('casting');
            
            playSound('cast');
            
            setTimeout(() => {
                document.getElementById('rod-display').classList.remove('casting');
                showBobber(castPower);
            }, 300);
        }

        function showBobber(power) {
            const area = document.getElementById('fishing-area');
            const bobber = document.getElementById('bobber');
            const line = document.getElementById('fishing-line');
            
            const x = 80 + (power / 100) * (area.offsetWidth - 200);
            const y = area.offsetHeight * 0.35 + (power / 100) * 100;
            
            bobber.style.left = x + 'px';
            bobber.style.top = y + 'px';
            bobber.style.display = 'block';
            
            line.style.left = '80px';
            line.style.top = (area.offsetHeight * 0.4) + 'px';
            line.style.height = Math.sqrt(Math.pow(x - 80, 2) + Math.pow(y - area.offsetHeight * 0.4, 2)) + 'px';
            line.style.transform = `rotate(${Math.atan2(y - area.offsetHeight * 0.4, x - 80) * 180 / Math.PI + 90}deg)`;
            line.style.display = 'block';
            
            document.getElementById('instruction').textContent = 'Waiting for a bite...';
            
            // Random wait time for bite
            const rod = rods[gameState.currentRod];
            const waitTime = 2000 + Math.random() * 5000 * (1 - rod.speedBonus);
            
            fishingTimeout = setTimeout(() => {
                startBite();
            }, waitTime);
        }

        function startBite() {
            const bobber = document.getElementById('bobber');
            bobber.classList.add('nibble');
            
            playSound('nibble');
            
            setTimeout(() => {
                bobber.classList.remove('nibble');
                bobber.classList.add('bite');
                document.getElementById('catch-prompt').style.display = 'block';
                document.getElementById('instruction').textContent = 'üéØ CLICK NOW!';
                
                playSound('bite');
                
                catchWindow = setTimeout(() => {
                    missedCatch();
                }, 1500);
            }, 500 + Math.random() * 1000);
        }

        function attemptCatch() {
            clearTimeout(catchWindow);
            catchWindow = null;
            
            document.getElementById('catch-prompt').style.display = 'none';
            document.getElementById('bobber').classList.remove('bite');
            
            // Start minigame
            startMinigame();
        }

        function startMinigame() {
            minigameActive = true;
            minigameProgress = 50;
            minigameTarget = 30 + Math.random() * 40;
            
            document.getElementById('progress-bar').style.display = 'block';
            document.getElementById('progress-target').style.left = (minigameTarget - 7) + '%';
            document.getElementById('instruction').textContent = 'Click to keep the bar in the zone!';
            
            const minigameInterval = setInterval(() => {
                if (!minigameActive) {
                    clearInterval(minigameInterval);
                    return;
                }
                
                minigameProgress -= 1.5;
                if (minigameProgress <= 0) {
                    minigameActive = false;
                    clearInterval(minigameInterval);
                    missedCatch();
                    return;
                }
                
                document.getElementById('progress-fill').style.width = minigameProgress + '%';
                
                // Check if in target zone
                if (Math.abs(minigameProgress - minigameTarget) < 15) {
                    // Success check
                    if (Math.random() < 0.02) {
                        minigameActive = false;
                        clearInterval(minigameInterval);
                        successfulCatch();
                    }
                }
            }, 50);
        }

        function handleMinigameClick() {
            minigameProgress = Math.min(100, minigameProgress + 8);
            document.getElementById('progress-fill').style.width = minigameProgress + '%';
            
            // Check success
            if (Math.abs(minigameProgress - minigameTarget) < 15) {
                if (Math.random() < 0.3) {
                    minigameActive = false;
                    successfulCatch();
                }
            }
            
            playSound('click');
        }

        function successfulCatch() {
            document.getElementById('progress-bar').style.display = 'none';
            
            // Determine catch
            currentCatch = determineCatch();
            
            playSound('catch', currentCatch.rarity);
            createParticles(currentCatch.rarity);
            
            // Update stats
            gameState.catches++;
            gameState.streak++;
            gameState.combo = Math.min(5, 1 + gameState.streak * 0.1);
            
            if (currentCatch.weight > gameState.biggestFish) {
                gameState.biggestFish = currentCatch.weight;
            }
            
            const rarityOrder = ['consumer', 'industrial', 'milspec', 'restricted', 'classified', 'covert', 'legendary'];
            const currentRarityIndex = rarityOrder.indexOf(currentCatch.rarity);
            const bestRarityIndex = rarityOrder.indexOf(gameState.rarestCatch.toLowerCase()) || -1;
            if (currentRarityIndex > bestRarityIndex) {
                gameState.rarestCatch = rarities[currentCatch.rarity].name;
            }
            
            // Update quests
            updateQuests(currentCatch);
            
            // Show modal
            showCatchModal(currentCatch);
            
            resetFishing();
        }

        function determineCatch() {
            const rod = rods[gameState.currentRod];
            const bait = baits[gameState.currentBait];
            const location = gameState.currentLocation;
            
            // Get available fish for this location
            const availableFish = Object.entries(fishDB).filter(([id, fish]) => 
                fish.location.includes(location)
            );
            
            // Determine rarity with bonuses
            let roll = Math.random();
            roll -= rod.luckBonus;
            roll -= bait.bonus;
            roll -= (gameState.weather === 'rain' ? 0.05 : 0);
            roll = Math.max(0, roll);
            
            let selectedRarity = 'consumer';
            let cumulative = 0;
            
            for (const [rarity, data] of Object.entries(rarities)) {
                cumulative += data.chance;
                if (roll < cumulative) {
                    selectedRarity = rarity;
                    break;
                }
            }
            
            // Get fish of selected rarity
            const fishOfRarity = availableFish.filter(([id, fish]) => fish.rarity === selectedRarity);
            
            if (fishOfRarity.length === 0) {
                // Fallback
                selectedRarity = 'consumer';
            }
            
            const finalFish = fishOfRarity.length > 0 
                ? fishOfRarity[Math.floor(Math.random() * fishOfRarity.length)]
                : availableFish.filter(([id, fish]) => fish.rarity === 'consumer')[0];
            
            const [fishId, fishData] = finalFish;
            
            // Calculate weight variation
            const weightVariation = 0.5 + Math.random() * 1.5;
            const weight = Math.round(fishData.baseWeight * weightVariation * 100) / 100;
            
            // Calculate value with combo
            const value = Math.round(fishData.baseValue * weightVariation * gameState.combo * rarities[fishData.rarity].multiplier);
            
            // XP based on rarity
            const xp = Math.round(10 * rarities[fishData.rarity].multiplier);
            
            const isNew = !gameState.discovered.has(fishId);
            if (isNew) {
                gameState.discovered.add(fishId);
            }
            
            return {
                id: fishId,
                ...fishData,
                weight,
                value,
                xp,
                isNew
            };
        }

        function showCatchModal(fish) {
            document.getElementById('modal-rarity').textContent = rarities[fish.rarity].name.toUpperCase();
            document.getElementById('modal-rarity').className = 'catch-rarity ' + fish.rarity;
            document.getElementById('modal-fish').textContent = fish.emoji;
            document.getElementById('modal-name').textContent = fish.name;
            document.getElementById('modal-weight').textContent = fish.weight + ' kg';
            document.getElementById('modal-value').textContent = 'üí∞ ' + fish.value;
            document.getElementById('modal-xp').textContent = '+' + fish.xp + ' XP';
            document.getElementById('modal-new').style.display = fish.isNew ? 'block' : 'none';
            
            document.getElementById('catch-modal').style.display = 'flex';
        }

        function keepFish() {
            if (!currentCatch) return;
            
            if (!gameState.inventory[currentCatch.id]) {
                gameState.inventory[currentCatch.id] = [];
            }
            gameState.inventory[currentCatch.id].push({
                weight: currentCatch.weight,
                value: currentCatch.value,
                caught: Date.now()
            });
            
            addXP(currentCatch.xp);
            showNotification(`${currentCatch.emoji} ${currentCatch.name} added to bag! +${currentCatch.xp} XP`);
            
            document.getElementById('catch-modal').style.display = 'none';
            currentCatch = null;
            updateUI();
            saveGame();
        }

        function sellFish() {
            if (!currentCatch) return;
            
            gameState.gold += currentCatch.value;
            gameState.totalEarned += currentCatch.value;
            
            addXP(Math.round(currentCatch.xp * 0.5));
            updateQuestProgress('earn', currentCatch.value);
            
            showNotification(`Sold ${currentCatch.name} for üí∞${currentCatch.value}!`);
            
            document.getElementById('catch-modal').style.display = 'none';
            currentCatch = null;
            updateUI();
            saveGame();
        }

        function missedCatch() {
            gameState.streak = 0;
            gameState.combo = 1;
            
            document.getElementById('progress-bar').style.display = 'none';
            document.getElementById('catch-prompt').style.display = 'none';
            document.getElementById('bobber').classList.remove('bite', 'nibble');
            
            showNotification('The fish got away! üêüüí®');
            playSound('miss');
            
            resetFishing();
        }

        function resetFishing() {
            isFishing = false;
            clearTimeout(fishingTimeout);
            clearTimeout(biteTimeout);
            catchWindow = null;
            minigameActive = false;
            
            document.getElementById('bobber').style.display = 'none';
            document.getElementById('fishing-line').style.display = 'none';
            document.getElementById('bobber').classList.remove('bite', 'nibble');
            document.getElementById('instruction').textContent = 'Click or press SPACE to cast!';
            
            // Use bait
            if (gameState.currentBait !== 'worm') {
                gameState.ownedBait[gameState.currentBait]--;
                if (gameState.ownedBait[gameState.currentBait] <= 0) {
                    delete gameState.ownedBait[gameState.currentBait];
                    gameState.currentBait = 'worm';
                }
            }
            
            updateUI();
        }

        function addXP(amount) {
            gameState.xp += amount;
            
            while (gameState.xp >= gameState.xpNeeded) {
                gameState.xp -= gameState.xpNeeded;
                gameState.level++;
                gameState.xpNeeded = Math.round(gameState.xpNeeded * 1.5);
                gameState.gems += 5;
                showNotification(`üéâ LEVEL UP! You are now level ${gameState.level}!`);
                playSound('levelup');
            }
        }

        function updateQuests(fish) {
            updateQuestProgress('catch', 1);
            if (fish.rarity) {
                quests.forEach(q => {
                    if (q.type === 'rarity' && q.rarityTarget === fish.rarity) {
                        q.progress++;
                    }
                });
            }
            renderQuests();
        }

        function updateQuestProgress(type, amount) {
            quests.forEach(q => {
                if (q.type === type) {
                    q.progress += amount;
                    if (q.progress >= q.target) {
                        completeQuest(q);
                    }
                }
            });
            renderQuests();
        }

        function completeQuest(quest) {
            if (quest.completed) return;
            quest.completed = true;
            gameState.gold += quest.reward;
            showNotification(`üéØ Quest Complete! +üí∞${quest.reward}`);
            playSound('quest');
        }

        function createParticles(rarity) {
            const container = document.getElementById('particles');
            const color = rarities[rarity].color;
            
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.background = color;
                particle.style.left = (40 + Math.random() * 20) + '%';
                particle.style.top = (40 + Math.random() * 20) + '%';
                particle.style.animationDelay = (Math.random() * 0.5) + 's';
                container.appendChild(particle);
                
                setTimeout(() => particle.remove(), 1500);
            }
        }

        function updateUI() {
            document.getElementById('gold-display').textContent = formatNumber(gameState.gold);
            document.getElementById('gems-display').textContent = formatNumber(gameState.gems);
            document.getElementById('level-display').textContent = `Level ${gameState.level}`;
            document.getElementById('xp-fill').style.width = (gameState.xp / gameState.xpNeeded * 100) + '%';
            
            document.getElementById('stat-catches').textContent = gameState.catches;
            document.getElementById('stat-rarest').textContent = gameState.rarestCatch;
            document.getElementById('stat-biggest').textContent = gameState.biggestFish + ' kg';
            document.getElementById('stat-earned').textContent = 'üí∞ ' + formatNumber(gameState.totalEarned);
            
            // Combo display
            if (gameState.streak > 1) {
                document.getElementById('streak-bonus').style.display = 'block';
                document.getElementById('streak-bonus').textContent = `üî• Streak x${gameState.streak}`;
            } else {
                document.getElementById('streak-bonus').style.display = 'none';
            }
            
            // Collection
            document.getElementById('collection-count').textContent = gameState.discovered.size;
            document.getElementById('total-fish').textContent = Object.keys(fishDB).length;
            document.getElementById('collection-fill').style.width = 
                (gameState.discovered.size / Object.keys(fishDB).length * 100) + '%';
            
            renderInventory();
            renderCollection();
        }

        function renderInventory() {
            const grid = document.getElementById('inventory-grid');
            grid.innerHTML = '';
            
            Object.entries(gameState.inventory).forEach(([fishId, catches]) => {
                const fish = fishDB[fishId];
                if (!fish || catches.length === 0) return;
                
                const card = document.createElement('div');
                card.className = `fish-card ${fish.rarity}`;
                card.innerHTML = `
                    <span class="fish-emoji">${fish.emoji}</span>
                    <span class="fish-count">x${catches.length}</span>
                `;
                card.onclick = () => showFishDetail(fishId);
                grid.appendChild(card);
            });
            
            if (grid.children.length === 0) {
                grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; opacity: 0.5;">No fish yet! Go fishing!</div>';
            }
        }

        function renderCollection() {
            const grid = document.getElementById('collection-grid');
            grid.innerHTML = '';
            
            Object.entries(fishDB).forEach(([fishId, fish]) => {
                const card = document.createElement('div');
                const discovered = gameState.discovered.has(fishId);
                card.className = `fish-card ${discovered ? fish.rarity : ''}`;
                card.style.opacity = discovered ? 1 : 0.3;
                card.innerHTML = `
                    <span class="fish-emoji">${discovered ? fish.emoji : '‚ùì'}</span>
                `;
                if (discovered) {
                    card.onclick = () => showFishDetail(fishId);
                }
                grid.appendChild(card);
            });
        }

        function showFishDetail(fishId) {
            const fish = fishDB[fishId];
            const inv = gameState.inventory[fishId] || [];
            
            alert(`${fish.emoji} ${fish.name}\nRarity: ${rarities[fish.rarity].name}\nOwned: ${inv.length}\nBase Value: üí∞${fish.baseValue}`);
        }

        function renderShop() {
            const rodsContainer = document.getElementById('rods-container');
            rodsContainer.innerHTML = '';
            
            Object.entries(rods).forEach(([rodId, rod]) => {
                const owned = gameState.ownedRods.includes(rodId);
                const equipped = gameState.currentRod === rodId;
                
                const item = document.createElement('div');
                item.className = `shop-item ${owned ? 'owned' : ''} ${equipped ? 'equipped' : ''}`;
                item.innerHTML = `
                    <div class="shop-icon">${rod.emoji}</div>
                    <div class="shop-info">
                        <div class="shop-name">${rod.name}</div>
                        <div class="shop-desc">${rod.desc}</div>
                    </div>
                    ${owned ? (equipped ? '<span>‚úì Equipped</span>' : '<span style="color:#4CAF50">Owned</span>') : 
                        `<div class="shop-price">üí∞ ${formatNumber(rod.price)}</div>`}
                `;
                
                item.onclick = () => {
                    if (owned) {
                        gameState.currentRod = rodId;
                        showNotification(`Equipped ${rod.name}!`);
                    } else if (gameState.gold >= rod.price) {
                        gameState.gold -= rod.price;
                        gameState.ownedRods.push(rodId);
                        gameState.currentRod = rodId;
                        showNotification(`Purchased ${rod.name}!`);
                        playSound('buy');
                    } else {
                        showNotification('Not enough gold!');
                    }
                    renderShop();
                    updateUI();
                    saveGame();
                };
                
                rodsContainer.appendChild(item);
            });
            
            // Bait
            const baitContainer = document.getElementById('bait-container');
            baitContainer.innerHTML = '';
            
            Object.entries(baits).forEach(([baitId, bait]) => {
                const owned = gameState.ownedBait[baitId] || 0;
                const equipped = gameState.currentBait === baitId;
                
                const item = document.createElement('div');
                item.className = `shop-item ${equipped ? 'equipped' : ''}`;
                item.innerHTML = `
                    <div class="shop-icon">${bait.emoji}</div>
                    <div class="shop-info">
                        <div class="shop-name">${bait.name} ${owned > 0 ? `(${owned})` : ''}</div>
                        <div class="shop-desc">${bait.desc}</div>
                    </div>
                    ${bait.price === 0 ? '<span>‚àû</span>' : `<div class="shop-price">üí∞ ${bait.price}/ea</div>`}
                `;
                
                item.onclick = () => {
                    if (owned > 0 || baitId === 'worm') {
                        gameState.currentBait = baitId;
                        showNotification(`Using ${bait.name}!`);
                    } else if (gameState.gold >= bait.price) {
                        gameState.gold -= bait.price * 10;
                        gameState.ownedBait[baitId] = (gameState.ownedBait[baitId] || 0) + 10;
                        showNotification(`Purchased 10x ${bait.name}!`);
                        playSound('buy');
                    } else {
                        showNotification('Not enough gold!');
                    }
                    renderShop();
                    updateUI();
                    saveGame();
                };
                
                baitContainer.appendChild(item);
            });
        }

        function renderLocations() {
            const container = document.getElementById('locations-container');
            container.innerHTML = '';
            
            Object.entries(locations).forEach(([locId, loc]) => {
                const unlocked = gameState.level >= loc.unlockLevel || loc.price === 0;
                const owned = locId === 'pond' || gameState.gold >= 0; // Simplified
                const active = gameState.currentLocation === locId;
                
                const card = document.createElement('div');
                card.className = `location-card ${active ? 'active' : ''} ${!unlocked ? 'locked' : ''}`;
                card.innerHTML = `
                    <div class="location-name">${loc.emoji} ${loc.name}</div>
                    <div class="location-desc">${loc.desc}</div>
                    ${!unlocked ? `<div style="color: #f44336; margin-top: 5px;">Unlock at Level ${loc.unlockLevel}</div>` : ''}
                    ${unlocked && loc.price > 0 ? `<div style="margin-top: 5px;">Travel: üí∞${loc.price}</div>` : ''}
                `;
                
                card.onclick = () => {
                    if (!unlocked) {
                        showNotification(`Unlock this at level ${loc.unlockLevel}!`);
                        return;
                    }
                    if (loc.price > 0 && gameState.gold < loc.price) {
                        showNotification('Not enough gold to travel!');
                        return;
                    }
                    if (loc.price > 0) {
                        gameState.gold -= loc.price;
                    }
                    gameState.currentLocation = locId;
                    showNotification(`Traveled to ${loc.name}!`);
                    renderLocations();
                    updateUI();
                    saveGame();
                };
                
                container.appendChild(card);
            });
        }

        function renderQuests() {
            const container = document.getElementById('quests-container');
            container.innerHTML = '';
            
            quests.forEach(q => {
                const progress = Math.min(q.progress, q.target);
                const percent = (progress / q.target) * 100;
                
                const item = document.createElement('div');
                item.className = 'quest-item';
                item.innerHTML = `
                    <span>${q.completed ? '‚úÖ' : 'üìã'}</span>
                    <div style="flex: 1">
                        <div style="font-size: 0.85rem; margin-bottom: 4px;">${q.desc}</div>
                        <div class="quest-progress">
                            <div class="quest-progress-fill" style="width: ${percent}%"></div>
                        </div>
                    </div>
                    <span style="font-size: 0.8rem; color: #4CAF50;">üí∞${q.reward}</span>
                `;
                container.appendChild(item);
            });
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('inventory-tab').style.display = tab === 'inventory' ? 'block' : 'none';
            document.getElementById('collection-tab').style.display = tab === 'collection' ? 'block' : 'none';
        }

        function switchShopTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('rods-tab').style.display = tab === 'rods' ? 'block' : 'none';
            document.getElementById('bait-tab').style.display = tab === 'bait' ? 'block' : 'none';
            document.getElementById('locations-tab').style.display = tab === 'locations' ? 'block' : 'none';
        }

        function showNotification(message) {
            const notif = document.getElementById('notification');
            notif.textContent = message;
            notif.classList.add('show');
            
            setTimeout(() => {
                notif.classList.remove('show');
            }, 3000);
        }

        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }

        function startGameLoop() {
            setInterval(() => {
                // Update game time
                gameState.gameTime = (gameState.gameTime + 1) % 1440;
                
                const hours = Math.floor(gameState.gameTime / 60);
                const mins = gameState.gameTime % 60;
                const ampm = hours >= 12 ? 'PM' : 'AM';
                const displayHours = hours % 12 || 12;
                document.getElementById('time-display').textContent = 
                    `${displayHours}:${mins.toString().padStart(2, '0')} ${ampm}`;
                
                // Update sun/moon
                const sun = document.getElementById('sun');
                if (hours >= 6 && hours < 18) {
                    sun.style.background = 'radial-gradient(circle, #fff7aa 0%, #ffd700 50%, transparent 70%)';
                } else {
                    sun.style.background = 'radial-gradient(circle, #f0f0f0 0%, #c0c0c0 50%, transparent 70%)';
                }
                
                // Random weather changes
                if (Math.random() < 0.001) {
                    const weathers = ['sunny', 'cloudy', 'rain'];
                    gameState.weather = weathers[Math.floor(Math.random() * weathers.length)];
                    document.getElementById('weather-icon').textContent = 
                        gameState.weather === 'sunny' ? '‚òÄÔ∏è' : 
                        gameState.weather === 'cloudy' ? '‚òÅÔ∏è' : 'üåßÔ∏è';
                }
            }, 1000);
        }

        // Sound System
        function playSound(type, rarity) {
            if (!gameState.soundEnabled) return;
            
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                switch(type) {
                    case 'cast':
                        oscillator.frequency.setValueAtTime(300, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(150, audioContext.currentTime + 0.2);
                        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                        oscillator.start();
                        oscillator.stop(audioContext.currentTime + 0.2);
                        break;
                    case 'nibble':
                        oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                        gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                        oscillator.start();
                        oscillator.stop(audioContext.currentTime + 0.1);
                        break;
                    case 'bite':
                        oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
                        oscillator.frequency.setValueAtTime(800, audioContext.currentTime + 0.1);
                        gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                        oscillator.start();
                        oscillator.stop(audioContext.currentTime + 0.2);
                        break;
                    case 'catch':
                        const freqs = { consumer: 500, industrial: 600, milspec: 700, restricted: 800, classified: 900, covert: 1000, legendary: 1200 };
                        oscillator.type = 'sine';
                        oscillator.frequency.setValueAtTime(freqs[rarity] || 500, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(freqs[rarity] * 1.5 || 750, audioContext.currentTime + 0.3);
                        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                        oscillator.start();
                        oscillator.stop(audioContext.currentTime + 0.5);
                        break;
                    case 'levelup':
                        oscillator.type = 'sine';
                        oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                        oscillator.frequency.setValueAtTime(500, audioContext.currentTime + 0.1);
                        oscillator.frequency.setValueAtTime(600, audioContext.currentTime + 0.2);
                        oscillator.frequency.setValueAtTime(800, audioContext.currentTime + 0.3);
                        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                        oscillator.start();
                        oscillator.stop(audioContext.currentTime + 0.5);
                        break;
                }
            } catch(e) {}
        }

        function toggleSound() {
            gameState.soundEnabled = !gameState.soundEnabled;
            showNotification(gameState.soundEnabled ? 'üîä Sound ON' : 'üîá Sound OFF');
        }

        // Save/Load
        function saveGame() {
            const saveData = {
                ...gameState,
                discovered: Array.from(gameState.discovered)
            };
            localStorage.setItem('cozyFishing', JSON.stringify(saveData));
        }

        function loadGame() {
            const saved = localStorage.getItem('cozyFishing');
            if (saved) {
                const data = JSON.parse(saved);
                Object.assign(gameState, data);
                gameState.discovered = new Set(data.discovered || []);
            }
        }

        // Auto-save
        setInterval(saveGame, 30000);

        // Initialize
        init();
    </script>
</body>
</html>
