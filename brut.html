<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BRUT</title>

    <!-- FAVICON: Cyber Miner -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3Cfilter id='glow'%3E%3CfeGaussianBlur stdDeviation='2.5' result='coloredBlur'/%3E%3CfeMerge%3E%3CfeMergeNode in='coloredBlur'/%3E%3CfeMergeNode in='SourceGraphic'/%3E%3C/feMerge%3E%3C/filter%3E%3C/defs%3E%3Crect width='100' height='100' fill='%2309090b' rx='20'/%3E%3Cpath d='M30 40 L30 70 L70 70 L70 40 L50 25 Z' fill='none' stroke='%23d8b4fe' stroke-width='3'/%3E%3Crect x='35' y='45' width='30' height='10' fill='%23a855f7' filter='url(%23glow)'/%3E%3Cpath d='M20 70 L10 85 M80 70 L90 85' stroke='%236366f1' stroke-width='3'/%3E%3C/svg%3E" type="image/svg+xml">

    <!-- LIBRARIES -->
    <script src="https://unpkg.com/@solana/web3.js@1.98.0/lib/index.iife.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">

    <!-- CUSTOM STYLES -->
    <style>
        :root {
            --neon-purple: #d946ef;
            --neon-blue: #3b82f6;
            --void-bg: #030005;
            --glass-border: rgba(255, 255, 255, 0.08);
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background-color: var(--void-bg);
            color: #e2e8f0;
            height: 100vh;
            overflow: hidden;
        }

        /* Background Animation Canvas */
        #bg-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.6;
        }

        /* CRT Scanline Effect */
        .scanlines {
            background: linear-gradient(
                to bottom,
                rgba(255,255,255,0),
                rgba(255,255,255,0) 50%,
                rgba(0,0,0,0.1) 50%,
                rgba(0,0,0,0.1)
            );
            background-size: 100% 4px;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: 999;
            opacity: 0.3;
        }

        .font-mono { font-family: 'JetBrains Mono', monospace; }

        /* Glassmorphism Cards */
        .cyber-glass {
            background: rgba(10, 5, 20, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }
        
        /* Cyberpunk Borders */
        .cyber-glass::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, var(--neon-purple), transparent);
            opacity: 0.5;
        }
        .cyber-glass::after {
            content: '';
            position: absolute;
            bottom: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, var(--neon-blue), transparent);
            opacity: 0.3;
        }

        /* Inputs */
        .cyber-input {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid #333;
            transition: all 0.3s ease;
        }
        .cyber-input:focus {
            border-color: var(--neon-purple);
            box-shadow: 0 0 15px rgba(217, 70, 239, 0.2);
            outline: none;
        }

        /* Custom Button */
        .btn-glitch {
            background: linear-gradient(45deg, #4f46e5, #9333ea);
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }
        .btn-glitch:hover {
            box-shadow: 0 0 20px rgba(147, 51, 234, 0.6);
            transform: translateY(-2px);
        }
        .btn-glitch::after {
            content: '';
            position: absolute;
            top: -50%; left: -50%; width: 200%; height: 200%;
            background: linear-gradient(transparent, rgba(255,255,255,0.2), transparent);
            transform: rotate(45deg) translate(-100%, -100%);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            100% { transform: rotate(45deg) translate(100%, 100%); }
        }

        /* Animations */
        .fade-in-up { animation: fadeInUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        /* HUD Mining Elements */
        .hud-grid {
            background-image: 
                linear-gradient(rgba(59, 130, 246, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(59, 130, 246, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .text-glow { text-shadow: 0 0 10px currentColor; }
    </style>
</head>
<body class="flex flex-col items-center justify-center p-4">

    <canvas id="bg-canvas"></canvas>
    <div class="scanlines"></div>

    <!-- MAIN APP CONTAINER -->
    <main class="w-full max-w-[480px] z-10 relative">
        
        <!-- Header -->
        <div class="flex items-center justify-between mb-6 fade-in-up" style="animation-delay: 0.1s;">
            <div class="flex items-center gap-4">
                <!-- MEMORABLE MINER LOGO -->
                <div class="relative group cursor-pointer">
                    <div class="absolute inset-0 bg-purple-600 rounded-full blur-lg opacity-40 group-hover:opacity-75 transition duration-500"></div>
                    <svg class="w-14 h-14 relative z-10 drop-shadow-2xl transition-transform transform group-hover:scale-110" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <!-- Helmet Shape -->
                        <path d="M25 40 C25 20, 75 20, 75 40 L75 75 L25 75 Z" fill="#18181b" stroke="#a855f7" stroke-width="2"/>
                        <!-- Visor (Eyes) -->
                        <rect x="30" y="45" width="40" height="10" rx="2" fill="#d8b4fe" class="animate-pulse">
                            <animate attributeName="opacity" values="0.7;1;0.7" dur="2s" repeatCount="indefinite" />
                        </rect>
                        <!-- Breathing Tubes -->
                        <path d="M25 65 L15 80 M75 65 L85 80" stroke="#4b5563" stroke-width="4" stroke-linecap="round"/>
                        <!-- Crossed Pickaxes (Behind) -->
                        <path d="M10 20 L90 90 M90 20 L10 90" stroke="#3b82f6" stroke-width="2" opacity="0.5" stroke-dasharray="4 4"/>
                    </svg>
                </div>
                <div>
                    <h1 class="text-4xl font-bold tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-white to-purple-400">BRUT</h1>
                    <div class="flex items-center gap-2">
                        <span class="text-xs text-blue-400 font-mono tracking-widest uppercase">Force Engine</span>
                        <span class="px-1.5 py-0.5 rounded bg-blue-500/10 border border-blue-500/20 text-[10px] text-blue-300 font-mono">V3.0</span>
                    </div>
                </div>
            </div>
            <!-- CPU Badge -->
            <div class="flex flex-col items-end">
                <div class="text-[10px] text-slate-400 font-mono uppercase tracking-widest mb-1">Threads</div>
                <div class="px-3 py-1 rounded border border-white/10 bg-black/40 text-purple-400 text-xs font-mono flex items-center gap-2 shadow-[0_0_10px_rgba(168,85,247,0.2)]">
                    <i class="fa-solid fa-microchip animate-pulse"></i> <span id="cpu-cores">--</span>
                </div>
            </div>
        </div>

        <!-- SETUP SCREEN -->
        <div id="screen-setup" class="cyber-glass rounded-2xl p-6 fade-in-up" style="animation-delay: 0.2s;">
            <!-- Decoration -->
            <div class="absolute top-0 right-0 p-3 opacity-20">
                <i class="fa-solid fa-fingerprint text-6xl text-white"></i>
            </div>

            <h2 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                <span class="w-1 h-6 bg-purple-500 rounded-full"></span>
                CONFIGURE TARGET
            </h2>

            <!-- Input Section -->
            <div class="space-y-6">
                <div class="relative">
                    <label class="flex justify-between text-xs font-bold text-slate-400 uppercase tracking-widest mb-2 ml-1">
                        <span id="input-label-text">Desired Suffix</span>
                        <span class="text-purple-500" id="char-count">0/10</span>
                    </label>
                    
                    <div class="relative group">
                        <input id="input-search" type="text" maxlength="10" 
                            class="cyber-input w-full rounded-xl px-5 py-5 text-2xl text-white font-mono uppercase tracking-[0.2em] placeholder-slate-700"
                            placeholder="WAGMI">
                        
                        <!-- The Preview / Mirror -->
                        <div class="absolute right-4 top-1/2 -translate-y-1/2 text-right pointer-events-none">
                            <div class="text-[10px] text-slate-500 uppercase font-bold mb-1">Preview</div>
                            <div class="font-mono text-sm" id="mirror-container">
                                <span class="text-slate-600">...</span><span id="mirror-text" class="text-slate-400"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Difficulty Readout -->
                    <div class="mt-3 flex justify-between items-start h-8">
                        <div id="error-msg" class="hidden text-xs text-red-400 font-bold flex items-center gap-1 bg-red-900/20 px-2 py-1 rounded">
                            <i class="fa-solid fa-triangle-exclamation"></i> INVALID: No 0, O, I, l
                        </div>
                        <div id="diff-est" class="text-xs font-mono text-slate-500 w-full flex justify-between">
                            <span>Difficulty: <span class="text-slate-300">-</span></span>
                            <span>Est: <span class="text-slate-300">-</span></span>
                        </div>
                    </div>
                </div>

                <!-- Control Panel -->
                <div class="grid grid-cols-2 gap-4">
                    <!-- Case Sensitive Toggle -->
                    <div class="bg-black/20 border border-white/5 rounded-xl p-3 cursor-pointer hover:bg-white/5 transition group" onclick="toggleCase()">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-xs font-bold text-slate-300 group-hover:text-white">Case Sensitive</span>
                            <div id="toggle-case-light" class="w-2 h-2 rounded-full bg-slate-700 shadow-sm transition-colors duration-300"></div>
                        </div>
                        <div class="text-[10px] text-slate-500 leading-tight mb-2">Exact match (Harder)</div>
                        <!-- Switch Visual -->
                        <div class="w-full h-1 bg-slate-800 rounded overflow-hidden">
                            <div id="toggle-case-bar" class="h-full w-0 bg-pink-500 transition-all duration-300"></div>
                        </div>
                    </div>

                    <!-- Position Toggle -->
                    <div class="bg-black/20 border border-white/5 rounded-xl p-3 cursor-pointer hover:bg-white/5 transition group" onclick="togglePosition()">
                        <div class="flex justify-between items-center mb-1">
                            <span id="pos-label" class="text-xs font-bold text-slate-300 group-hover:text-white">Suffix</span>
                            <i id="pos-icon" class="fa-solid fa-align-right text-xs text-slate-600 transition-transform"></i>
                        </div>
                        <div id="pos-desc" class="text-[10px] text-slate-500 leading-tight mb-2">Address ends with...</div>
                        <div class="flex gap-1">
                            <div id="pos-bar-1" class="h-1 w-full bg-slate-800 rounded transition-colors"></div>
                            <div id="pos-bar-2" class="h-1 w-full bg-blue-500 rounded transition-colors"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Button -->
            <button onclick="startMining()" class="btn-glitch w-full mt-8 py-4 rounded-xl font-bold text-lg text-white shadow-xl flex items-center justify-center gap-3 group border border-white/20">
                <i class="fa-solid fa-rocket group-hover:-translate-y-1 transition-transform"></i>
                <span>INITIALIZE MINERS</span>
            </button>
        </div>

        <!-- SUCCESS SCREEN -->
        <div id="screen-wallet" class="hidden cyber-glass rounded-2xl p-1 pb-4 fade-in-up">
            <!-- Header Banner -->
            <div class="bg-gradient-to-r from-green-900/40 to-emerald-900/40 border-b border-green-500/20 p-4 mb-4 flex justify-between items-center">
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse shadow-[0_0_10px_#4ade80]"></div>
                    <span class="text-green-400 font-bold tracking-widest text-sm uppercase">Target Acquired</span>
                </div>
                <i class="fa-solid fa-unlock text-green-500/50"></i>
            </div>

            <div class="px-5 space-y-5">
                <!-- Public Key -->
                <div class="space-y-2">
                    <div class="flex justify-between items-end">
                        <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Public Address</span>
                        <button onclick="copyPub()" id="btn-copy-pub" class="text-[10px] bg-white/5 hover:bg-white/10 text-white px-2 py-1 rounded transition border border-white/10">COPY</button>
                    </div>
                    <div id="pubkey-display" class="font-mono text-sm text-slate-300 break-all bg-black/40 p-4 rounded-lg border border-white/5 shadow-inner">
                        ...
                    </div>
                    <textarea id="hidden-pub" class="fixed -left-[9999px]"></textarea>
                </div>

                <!-- Private Key -->
                <div class="relative group">
                    <div class="absolute -inset-0.5 bg-gradient-to-r from-red-600 to-orange-600 rounded-xl opacity-20 group-hover:opacity-40 transition duration-500 blur"></div>
                    <div class="relative bg-[#0f0505] rounded-xl p-4 border border-red-500/20">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-[10px] font-bold text-red-400 uppercase tracking-widest flex items-center gap-2">
                                <i class="fa-solid fa-shield-halved"></i> Private Key
                            </span>
                            <button onclick="copySecret()" id="btn-copy-secret" class="text-[10px] text-red-400 bg-red-500/10 border border-red-500/20 hover:bg-red-500/20 px-3 py-1 rounded transition">COPY SECRET</button>
                        </div>
                        
                        <div onclick="toggleSecret()" id="secret-display" class="font-mono text-[10px] text-red-300/80 break-all cursor-pointer p-2 rounded transition-all duration-300 select-none blur-md hover:bg-red-500/5 border border-transparent hover:border-red-500/10">
                            (Hidden)
                        </div>
                        <div class="text-center mt-2 pointer-events-none">
                            <span class="text-[9px] text-red-600 uppercase font-bold tracking-widest">Click to Reveal</span>
                        </div>
                        <textarea id="hidden-secret" class="fixed -left-[9999px]"></textarea>
                    </div>
                </div>

                <button onclick="location.reload()" class="w-full py-3 mt-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10 text-xs font-bold text-slate-300 transition uppercase tracking-widest">
                    <i class="fa-solid fa-rotate-right mr-2"></i> Generate New
                </button>
            </div>
        </div>

    </main>

    <!-- MINING OVERLAY (HUD) -->
    <div id="miner-ui" class="fixed inset-0 bg-black/95 z-50 hidden flex-col items-center justify-center backdrop-blur-md">
        <div class="hud-grid absolute inset-0 opacity-20"></div>
        
        <div class="relative z-10 w-full max-w-[400px] p-6 text-center">
            
            <!-- Loading Hexagon -->
            <div class="relative w-32 h-32 mx-auto mb-8 flex items-center justify-center">
                <svg class="animate-spin duration-[3s] w-full h-full absolute text-purple-900 opacity-50" viewBox="0 0 100 100">
                    <path d="M50 5 L93 28 L93 72 L50 95 L7 72 L7 28 Z" fill="none" stroke="currentColor" stroke-width="1"/>
                </svg>
                <svg class="animate-spin duration-[1.5s] w-24 h-24 absolute text-purple-500" viewBox="0 0 100 100">
                    <path d="M50 10 L85 30 L85 70 L50 90 L15 70 L15 30 Z" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="20 10"/>
                </svg>
                <div class="text-2xl text-white font-mono animate-pulse">
                    <i class="fa-solid fa-crosshairs"></i>
                </div>
            </div>

            <h2 class="text-3xl font-bold text-white mb-2 tracking-tighter">BRUT_FORCE</h2>
            <div class="text-sm font-mono text-purple-400 mb-8 border border-purple-500/30 bg-purple-500/10 inline-block px-4 py-1 rounded">
                TARGETING :: <span id="mining-target" class="font-bold text-white ml-1 glow">---</span>
            </div>

            <!-- Probability Bar -->
            <div class="w-full mb-8">
                <div class="flex justify-between text-[10px] text-slate-400 font-mono mb-1 uppercase">
                    <span>Probability Matrix</span>
                    <span id="prob-pct" class="text-white">0%</span>
                </div>
                <div class="h-1 bg-slate-800 w-full overflow-hidden">
                    <div id="prob-bar" class="h-full bg-gradient-to-r from-blue-500 to-purple-500 w-0 transition-all duration-300 shadow-[0_0_10px_#a855f7]"></div>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-cols-2 gap-4 mb-8">
                <div class="bg-black/50 border border-slate-700 p-3">
                    <div class="text-[9px] text-slate-500 uppercase tracking-widest mb-1">Total Attempts</div>
                    <div id="checked-count" class="text-xl font-mono text-white leading-none">0</div>
                </div>
                <div class="bg-black/50 border border-slate-700 p-3 relative overflow-hidden">
                    <div class="text-[9px] text-slate-500 uppercase tracking-widest mb-1">Hash Rate</div>
                    <div id="speed-count" class="text-xl font-mono text-green-400 leading-none text-glow">0</div>
                    <div class="absolute bottom-0 right-0 text-[8px] text-slate-600 p-1">k/s</div>
                </div>
            </div>

            <button onclick="cancelMining()" class="px-8 py-3 rounded border border-red-500/50 text-red-400 text-xs font-bold uppercase hover:bg-red-500/10 hover:shadow-[0_0_15px_rgba(239,68,68,0.2)] transition tracking-widest">
                Abort Sequence
            </button>
        </div>
    </div>

    <!-- WORKER SCRIPT -->
    <script id="worker-code" type="javascript/worker">
        importScripts('https://unpkg.com/@solana/web3.js@1.98.0/lib/index.iife.min.js');
        
        self.onmessage = function(e) {
            const { target, isCaseSensitive, position, batchSize } = e.data;
            const searchStr = isCaseSensitive ? target : target.toLowerCase();
            
            while (true) {
                let count = 0;
                for (let i = 0; i < batchSize; i++) {
                    const kp = solanaWeb3.Keypair.generate();
                    const addr = kp.publicKey.toString();
                    
                    let match = false;
                    
                    if (position === 'start') {
                        match = isCaseSensitive 
                            ? addr.startsWith(searchStr) 
                            : addr.toLowerCase().startsWith(searchStr);
                    } else {
                        match = isCaseSensitive 
                            ? addr.endsWith(searchStr) 
                            : addr.toLowerCase().endsWith(searchStr);
                    }
    
                    if (match) {
                        self.postMessage({ found: true, secret: Array.from(kp.secretKey), pub: addr });
                        return;
                    }
                    count++;
                }
                self.postMessage({ found: false, count: count });
            }
        };
    </script>

    <!-- APP LOGIC -->
    <script type="module">
        import bs58 from 'https://esm.sh/bs58@5.0.0';

        // State
        let isCaseSensitive = false;
        let position = 'end'; // 'end' | 'start'
        let workers = [];
        let startTime;
        let totalChecked = 0;
        let errorTimeout;

        // Visuals state
        const inputEl = document.getElementById('input-search');
        const mirrorText = document.getElementById('mirror-text');
        const mirrorContainer = document.getElementById('mirror-container');
        const diffEl = document.getElementById('diff-est');
        const errorEl = document.getElementById('error-msg');
        
        // --- Starfield Background Logic ---
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');
        let stars = [];
        let warpSpeed = 0; // 0 = normal, 1 = warp
        
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        class Star {
            constructor() {
                this.reset();
            }
            reset() {
                this.x = (Math.random() - 0.5) * canvas.width * 2;
                this.y = (Math.random() - 0.5) * canvas.height * 2;
                this.z = Math.random() * canvas.width;
                this.pz = this.z;
            }
            update() {
                let speed = 2 + (warpSpeed * 30);
                this.z = this.z - speed;
                if (this.z < 1) {
                    this.reset();
                    this.z = canvas.width;
                    this.pz = this.z;
                }
            }
            draw() {
                let sx = (this.x / this.z) * (canvas.width/2) + (canvas.width/2);
                let sy = (this.y / this.z) * (canvas.height/2) + (canvas.height/2);
                
                // Trail effect logic
                let px = (this.x / this.pz) * (canvas.width/2) + (canvas.width/2);
                let py = (this.y / this.pz) * (canvas.height/2) + (canvas.height/2);

                this.pz = this.z;

                if (sx < 0 || sx > canvas.width || sy < 0 || sy > canvas.height) return;

                let r = (1 - this.z / canvas.width) * 3;
                
                ctx.beginPath();
                if(warpSpeed > 0.1) {
                    ctx.moveTo(px, py);
                    ctx.lineTo(sx, sy);
                    ctx.strokeStyle = `rgba(216, 180, 254, ${r/3})`;
                    ctx.lineWidth = r;
                    ctx.stroke();
                } else {
                    ctx.arc(sx, sy, r, 0, Math.PI * 2);
                    ctx.fillStyle = "white";
                    ctx.fill();
                }
            }
        }

        function initStars() {
            for(let i=0; i<400; i++) stars.push(new Star());
            animateStars();
        }
        function animateStars() {
            ctx.fillStyle = "rgba(3, 0, 5, 0.3)"; // Trail fade
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            stars.forEach(s => { s.update(); s.draw(); });
            requestAnimationFrame(animateStars);
        }
        initStars();

        // --- Core Logic ---

        const logicalProcessors = navigator.hardwareConcurrency || 4;
        document.getElementById('cpu-cores').innerText = logicalProcessors;

        window.toggleCase = () => {
            isCaseSensitive = !isCaseSensitive;
            const bar = document.getElementById('toggle-case-bar');
            const light = document.getElementById('toggle-case-light');
            
            if(isCaseSensitive) {
                bar.classList.replace('w-0', 'w-full');
                light.classList.replace('bg-slate-700', 'bg-pink-500');
                light.classList.add('shadow-[0_0_8px_#ec4899]');
            } else {
                bar.classList.replace('w-full', 'w-0');
                light.classList.replace('bg-pink-500', 'bg-slate-700');
                light.classList.remove('shadow-[0_0_8px_#ec4899]');
            }
            updateMirror();
            calculateDifficulty();
        };

        window.togglePosition = () => {
            position = (position === 'end') ? 'start' : 'end';
            const bar1 = document.getElementById('pos-bar-1');
            const bar2 = document.getElementById('pos-bar-2');
            const label = document.getElementById('pos-label');
            const desc = document.getElementById('pos-desc');
            const icon = document.getElementById('pos-icon');
            const labelMain = document.getElementById('input-label-text');

            if(position === 'start') {
                bar1.classList.replace('bg-slate-800', 'bg-blue-500');
                bar2.classList.replace('bg-blue-500', 'bg-slate-800');
                label.innerText = "Prefix";
                desc.innerText = "Starts with...";
                labelMain.innerText = "Desired Prefix";
                icon.classList.replace('fa-align-right', 'fa-align-left');
            } else {
                bar1.classList.replace('bg-blue-500', 'bg-slate-800');
                bar2.classList.replace('bg-slate-800', 'bg-blue-500');
                label.innerText = "Suffix";
                desc.innerText = "Ends with...";
                labelMain.innerText = "Desired Suffix";
                icon.classList.replace('fa-align-left', 'fa-align-right');
            }
            updateMirror();
            calculateDifficulty();
        };

        inputEl.addEventListener('input', (e) => {
            let val = e.target.value;
            const forbidden = /[0OIl]/;
            if(forbidden.test(val)) {
                showError();
                inputEl.parentElement.classList.add('shake');
                setTimeout(() => inputEl.parentElement.classList.remove('shake'), 400);
            }
            // Filter invalid chars
            val = val.replace(/[^1-9A-HJ-NP-Za-km-z]/g, '');
            e.target.value = val;
            
            document.getElementById('char-count').innerText = `${val.length}/10`;
            
            updateMirror();
            calculateDifficulty();
        });

        function updateMirror() {
            const val = inputEl.value;
            const container = mirrorContainer;
            const textSpan = document.getElementById('mirror-text');
            
            // Preview Logic: 
            // If Case Sensitive ON: Show exact input in PINK/Neon.
            // If Case Sensitive OFF: Show Uppercase (since standard solana view usually defaults visually) 
            // but keep color neutral to imply "loose" matching.
            
            let displayVal = val;
            
            if (isCaseSensitive) {
                textSpan.className = "text-pink-500 font-bold drop-shadow-[0_0_5px_rgba(236,72,153,0.5)]";
            } else {
                textSpan.className = "text-slate-400";
                displayVal = val.length > 0 ? `${val} (any)` : '';
            }
            
            textSpan.innerText = displayVal;

            if (position === 'start') {
                container.innerHTML = `<span id="mirror-text" class="${textSpan.className}">${displayVal}</span><span class="text-slate-600">...</span>`;
            } else {
                container.innerHTML = `<span class="text-slate-600">...</span><span id="mirror-text" class="${textSpan.className}">${displayVal}</span>`;
            }
        }

        function showError() {
            diffEl.classList.add('hidden');
            errorEl.classList.remove('hidden');
            errorEl.classList.add('shake');
            clearTimeout(errorTimeout);
            errorTimeout = setTimeout(() => {
                errorEl.classList.add('hidden');
                errorEl.classList.remove('shake');
                diffEl.classList.remove('hidden');
            }, 3000);
        }

        function calculateDifficulty() {
            const val = inputEl.value;
            if (!val) {
                diffEl.innerHTML = `<span>Difficulty: <span class="text-slate-300">-</span></span><span>Est: <span class="text-slate-300">-</span></span>`;
                return;
            }

            const len = val.length;
            const pool = isCaseSensitive ? 58 : 32; 
            const combinations = Math.pow(pool, len);
            const estSpeed = logicalProcessors * 6000; // conservative estimate per thread
            const seconds = combinations / estSpeed;

            let timeStr = "";
            let colorClass = "text-green-400";

            if (seconds < 1) timeStr = "Instant";
            else if (seconds < 60) timeStr = `~${Math.ceil(seconds)}s`;
            else if (seconds < 3600) { timeStr = `~${Math.ceil(seconds/60)}m`; colorClass = "text-blue-400"; }
            else if (seconds < 86400) { timeStr = `~${(seconds/3600).toFixed(1)}h`; colorClass = "text-yellow-400"; }
            else { timeStr = `~${(seconds/86400).toFixed(1)} days`; colorClass = "text-red-400"; }

            diffEl.innerHTML = `
                <span>Diff: <span class="text-white font-mono">1/${combinations.toExponential(1)}</span></span>
                <span>Est: <span class="${colorClass} font-bold font-mono">${timeStr}</span></span>
            `;
        }

        // --- Mining Execution ---

        window.startMining = () => {
            const target = inputEl.value.trim();
            if(!target) return inputEl.focus();

            // UI Transitions
            warpSpeed = 1; // Engage Warp Speed in background
            document.getElementById('screen-setup').style.opacity = '0.1';
            const minerUI = document.getElementById('miner-ui');
            minerUI.classList.remove('hidden');
            minerUI.classList.add('flex');
            
            document.getElementById('mining-target').innerText = target;
            document.getElementById('prob-bar').style.width = '0%';
            document.getElementById('prob-pct').innerText = '0%';
            document.getElementById('checked-count').innerText = '0';
            document.getElementById('speed-count').innerText = '0';

            // Init Workers
            totalChecked = 0;
            startTime = Date.now();

            const workerContent = document.getElementById('worker-code').textContent;
            const blob = new Blob([workerContent], { type: 'text/javascript' });
            const workerUrl = URL.createObjectURL(blob);

            workers = [];
            for(let i=0; i<logicalProcessors; i++) {
                const w = new Worker(workerUrl);
                w.onmessage = handleWorkerMessage;
                w.postMessage({ 
                    target, 
                    isCaseSensitive,
                    position,
                    batchSize: 500 // Batch size for update frequency
                });
                workers.push(w);
            }

            updateStats();
        };

        function handleWorkerMessage(e) {
            if (e.data.found) {
                terminateWorkers();
                const kp = solanaWeb3.Keypair.fromSecretKey(new Uint8Array(e.data.secret));
                successMining(kp, e.data.pub);
            } else {
                totalChecked += e.data.count;
            }
        }

        function updateStats() {
            if(workers.length === 0) return;

            const now = Date.now();
            const elapsed = (now - startTime) / 1000;
            const speed = Math.floor(totalChecked / elapsed) || 0;

            // Update DOM with random fluctuation for "tech" feel
            document.getElementById('checked-count').innerText = totalChecked.toLocaleString();
            document.getElementById('speed-count').innerText = speed.toLocaleString();

            const pool = isCaseSensitive ? 58 : 32; 
            const targetLen = inputEl.value.length;
            const combinations = Math.pow(pool, targetLen);
            
            let prob = 1 - Math.pow((combinations - 1) / combinations, totalChecked);
            if(prob > 0.9999) prob = 0.9999;
            
            const pct = (prob * 100).toFixed(4) + '%';
            document.getElementById('prob-bar').style.width = (prob * 100) + '%';
            document.getElementById('prob-pct').innerText = pct;

            requestAnimationFrame(updateStats);
        }

        function terminateWorkers() {
            workers.forEach(w => w.terminate());
            workers = [];
            warpSpeed = 0; // Disengage warp
            document.getElementById('screen-setup').style.opacity = '1';
        }

        function successMining(kp, pubkey) {
            document.getElementById('miner-ui').classList.add('hidden');
            document.getElementById('miner-ui').classList.remove('flex');
            document.getElementById('screen-setup').classList.add('hidden');
            document.getElementById('screen-wallet').classList.remove('hidden');

            const secret = bs58.encode(kp.secretKey);
            document.getElementById('hidden-secret').value = secret;
            document.getElementById('hidden-pub').value = pubkey;
            document.getElementById('secret-display').innerText = secret;

            // Highlight the matching part
            const target = inputEl.value;
            const len = target.length;
            let displayHtml = "";

            // Check actual casing match for highlighting
            // Since we found it, we know it matches the criteria, but let's visually highlight properly
            if (position === 'start') {
                 const prefix = pubkey.substring(0, len);
                 const rest = pubkey.substring(len);
                 displayHtml = `<span class="text-green-400 font-bold drop-shadow-[0_0_8px_rgba(74,222,128,0.5)] border-b border-green-500">${prefix}</span>${rest}`;
            } else {
                 const prefix = pubkey.slice(0, -len);
                 const suffix = pubkey.slice(-len);
                 displayHtml = `${prefix}<span class="text-green-400 font-bold drop-shadow-[0_0_8px_rgba(74,222,128,0.5)] border-b border-green-500">${suffix}</span>`;
            }
            
            document.getElementById('pubkey-display').innerHTML = displayHtml;
        }

        window.cancelMining = () => {
            terminateWorkers();
            document.getElementById('miner-ui').classList.add('hidden');
            document.getElementById('miner-ui').classList.remove('flex');
        };

        window.copySecret = () => smartCopy(document.getElementById('hidden-secret').value, 'btn-copy-secret');
        window.copyPub = () => smartCopy(document.getElementById('hidden-pub').value, 'btn-copy-pub');
        
        window.toggleSecret = () => {
            const el = document.getElementById('secret-display');
            if(el.classList.contains('blur-md')) {
                el.classList.remove('blur-md', 'select-none', 'text-red-300/80');
                el.classList.add('text-red-400', 'bg-red-500/10');
            } else {
                el.classList.add('blur-md', 'select-none', 'text-red-300/80');
                el.classList.remove('text-red-400', 'bg-red-500/10');
            }
        };

        function smartCopy(text, btnId) {
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.getElementById(btnId);
                const originalText = btn.innerText;
                btn.innerText = "COPIED";
                btn.classList.add('bg-green-500', 'text-black', 'border-transparent');
                setTimeout(() => {
                    btn.innerText = originalText;
                    btn.classList.remove('bg-green-500', 'text-black', 'border-transparent');
                }, 2000);
            });
        }
    </script>
</body>
</html>
